<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 8.0.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">

<link rel="stylesheet" href="google/css2?family=Lato:ital,wght@0,300;0,400;0,700;1,300;1,400;1,700&family=PingFang+SC:ital,wght@0,300;0,400;0,700;1,300;1,400;1,700&family=Hiragino+Sans+GB:ital,wght@0,300;0,400;0,700;1,300;1,400;1,700&family=Microsoft+YaHei:ital,wght@0,300;0,400;0,700;1,300;1,400;1,700&family=sans-serif:ital,wght@0,300;0,400;0,700;1,300;1,400;1,700&family=Roboto:ital,wght@0,300;0,400;0,700;1,300;1,400;1,700&family='Noto+Serif+SC':ital,wght@0,300;0,400;0,700;1,300;1,400;1,700&family=Georgia:ital,wght@0,300;0,400;0,700;1,300;1,400;1,700&family=serif:ital,wght@0,300;0,400;0,700;1,300;1,400;1,700&family='JetBrains+Mono':ital,wght@0,300;0,400;0,700;1,300;1,400;1,700&family='Fira+Code':ital,wght@0,300;0,400;0,700;1,300;1,400;1,700&family=Consolas:ital,wght@0,300;0,400;0,700;1,300;1,400;1,700&family=Monaco:ital,wght@0,300;0,400;0,700;1,300;1,400;1,700&family=monospace:ital,wght@0,300;0,400;0,700;1,300;1,400;1,700&display=swap&subset=latin,latin-ext">

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.0.0/css/all.min.css" integrity="sha256-VHqXKFhhMxcpubYf9xiWdCiojEbY9NexQ4jh8AxbvcM=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"example.com","root":"/","images":"/images","scheme":"Mist","darkmode":false,"version":"8.25.0","exturl":false,"sidebar":{"position":"left","width_expanded":320,"width_dual_column":240,"display":"post","padding":18,"offset":12},"hljswrap":true,"codeblock":{"theme":{"light":"default","dark":"stackoverflow-dark"},"prism":{"light":"prism","dark":"prism-dark"},"copy_button":{"enable":false,"style":null},"fold":{"enable":false,"height":500},"language":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":"giscus","storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"duration":200,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"}}</script><script src="/js/config.js" defer></script>

    <meta name="description" content="记录学习过程中的思考、题解与复盘">
<meta property="og:type" content="website">
<meta property="og:title" content="nine19een&#39;s Blog">
<meta property="og:url" content="http://example.com/index.html">
<meta property="og:site_name" content="nine19een&#39;s Blog">
<meta property="og:description" content="记录学习过程中的思考、题解与复盘">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="nine19een">
<meta property="article:tag" content="算法, 算法竞赛, C++, 题解&#x2F;复盘">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="http://example.com/">


<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":true,"isPost":false,"lang":"zh-CN","comments":"","permalink":"","path":"index.html","title":""}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>nine19een's Blog</title>
  








  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous" defer></script>
<script src="/js/utils.js" defer></script><script src="/js/motion.js" defer></script><script src="/js/sidebar.js" defer></script><script src="/js/next-boot.js" defer></script>

  






  





  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">nine19een's Blog</h1>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">一名大一cs新生的学习记录</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="搜索" role="button">
    </div>
  </div>
</div>







</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">nine19een</p>
  <div class="site-description" itemprop="description">记录学习过程中的思考、题解与复盘</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">5</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
        <span class="site-state-item-count">2</span>
        <span class="site-state-item-name">分类</span>
      </div>
      <div class="site-state-item site-state-tags">
        <span class="site-state-item-count">16</span>
        <span class="site-state-item-name">标签</span>
      </div>
  </nav>
</div>

        </div>
      </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2025/10/25/Luogu-P1133-FlowerGardenDP/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="nine19een">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="nine19een's Blog">
      <meta itemprop="description" content="记录学习过程中的思考、题解与复盘">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content=" | nine19een's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2025/10/25/Luogu-P1133-FlowerGardenDP/" class="post-title-link" itemprop="url">洛谷-P1133-教主的花园·复盘——从线性DP到环形DP</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2025-10-25 02:00:00 / 修改时间：02:14:04" itemprop="dateCreated datePublished" datetime="2025-10-25T02:00:00+08:00">2025-10-25</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E7%AE%97%E6%B3%95%E9%A2%98%E8%A7%A3-%E5%A4%8D%E7%9B%98/" itemprop="url" rel="index"><span itemprop="name">算法题解/复盘</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>最近，我解决了一道经典的 <strong>环形DP</strong> 问题。该问题具有较强的迷惑性，我设计了一个看似正确的线性DP模型，实际上忽略了问题最核心的 <strong>环形</strong> 约束。本文旨在完整复盘从一个70分的线性解，到一个90分的 <strong>错误补丁</strong> 解，最终到100分AC的 <strong>破环成链</strong> 正解的全过程，深入剖析每一步的思维误区与正确建模的关键。</p>
<hr>
<h2 id="题目分析"><a href="#题目分析" class="headerlink" title="题目分析"></a>题目分析</h2><p><strong><a target="_blank" rel="noopener" href="https://www.luogu.com.cn/problem/P1133">P1133 教主的花园</a></strong></p>
<img src="/2025/10/25/Luogu-P1133-FlowerGardenDP/1.png" class="" title="题面">

<p>提炼题目要素：</p>
<ol>
<li><strong>布局</strong>：<strong>环形</strong> 排列。</li>
<li><strong>约束</strong>：任何一棵树必须比其左右相邻的树 <strong>同时更高或更矮</strong>，形成 <strong>波峰</strong> 或 <strong>波谷</strong>。</li>
<li><strong>目标</strong>：观赏价值总和最大。</li>
</ol>
<p>这是一个动态规划问题。核心在于状态的设计。为了存储输入的观赏价值，我使用了一个 <code>Plant_Position</code> 结构体，其中 <code>pos[i].ten</code>, <code>pos[i].twenty</code>, <code>pos[i].thirty</code> 持有位置 <code>i</code> 的相应价值。</p>
<p>为了判断位置 <code>i</code> 的种植是否合法，不仅需要知道位置 <code>i-1</code> 的高度，还需要知道 <code>i-1</code> 相对于 <code>i-2</code> 的趋势，这样才能决定 <code>i</code> 的合法走向。因此，一个三维状态是必要的：<code>dp[i][j][k]</code>。</p>
<ul>
<li><code>i</code>：表示正在考虑第 <code>i</code> 棵树。</li>
<li><code>j</code>：表示第 <code>i</code> 棵树的高度。我们用 <code>1, 2, 3</code> 分别代表高度 <code>10, 20, 30</code>。</li>
<li><code>k</code>：表示第 <code>i</code> 棵树的形态。<ul>
<li><code>k=0</code>：第 <code>i</code> 棵树是 <strong>波谷</strong>，即 <code>H[i-1] &gt; H[i]</code>，从 <code>i-1</code> 到 <code>i</code> 是 <strong>下降</strong> 趋势。</li>
<li><code>k=1</code>：第 <code>i</code> 棵树是 <strong>波峰</strong>，即 <code>H[i-1] &lt; H[i]</code>，从 <code>i-1</code> 到 <code>i</code> 是 <strong>上升</strong> 趋势。</li>
</ul>
</li>
</ul>
<p><code>dp[i][j][k]</code> 的值，就代表满足以上定义时的最大观赏价值。</p>
<hr>
<h2 id="算法设计及实现"><a href="#算法设计及实现" class="headerlink" title="算法设计及实现"></a>算法设计及实现</h2><h3 id="V1-0-线性DP的初步尝试-70分"><a href="#V1-0-线性DP的初步尝试-70分" class="headerlink" title="V1.0 线性DP的初步尝试 (70分)"></a><strong>V1.0 线性DP的初步尝试 (70分)</strong></h3><h4 id="设计"><a href="#设计" class="headerlink" title="设计"></a><strong>设计</strong></h4><p>最初的方案完全忽略了 <strong>环形</strong> 约束，将花园视为一个从 <code>1</code> 到 <code>n</code> 的 <strong>线性序列</strong>。基于上述 <code>dp[i][j][k]</code> 状态，可以推导出所有合法的状态转移方程。</p>
<p><strong>状态转移方程详解：</strong></p>
<ol>
<li><p><strong>目标状态: <code>dp[i][1][0]</code> (高度 <code>10</code> , 波谷&#x2F;下降)</strong></p>
<ul>
<li><strong>逻辑</strong>: 要下降到高度 <code>10</code> ，前一个位置 <code>i-1</code> 的高度必须是 <code>20</code> 或 <code>30</code> 。同时，为了形成波谷，前一个位置 <code>i-1</code> 必须是波峰（上升趋势，<code>k=1</code>）。</li>
<li><strong>方程</strong>: <code>dp[i][1][0] = max(dp[i-1][2][1], dp[i-1][3][1]) + pos[i].ten</code></li>
</ul>
</li>
<li><p><strong>目标状态: <code>dp[i][2][0]</code> (高度 <code>20</code> , 波谷&#x2F;下降)</strong></p>
<ul>
<li><strong>逻辑</strong>: 要下降到高度 <code>20</code> ，前一个位置 <code>i-1</code> 的高度必须是 <code>30</code> 。前一个位置 <code>i-1</code> 必须是波峰（上升趋势，<code>k=1</code>）。</li>
<li><strong>方程</strong>: <code>dp[i][2][0] = dp[i-1][3][1] + pos[i].twenty</code></li>
</ul>
</li>
<li><p><strong>目标状态: <code>dp[i][2][1]</code> (高度 <code>20</code> , 波峰&#x2F;上升)</strong></p>
<ul>
<li><strong>逻辑</strong>: 要上升到高度 <code>20</code> ，前一个位置 <code>i-1</code> 的高度必须是 <code>10</code> 。前一个位置 <code>i-1</code> 必须是波谷（下降趋势，<code>k=0</code>）。</li>
<li><strong>方程</strong>: <code>dp[i][2][1] = dp[i-1][1][0] + pos[i].twenty</code></li>
</ul>
</li>
<li><p><strong>目标状态: <code>dp[i][3][1]</code> (高度 <code>30</code> , 波峰&#x2F;上升)</strong></p>
<ul>
<li><strong>逻辑</strong>: 要上升到高度 <code>30</code> ，前一个位置 <code>i-1</code> 的高度可以是 <code>10</code> 或 <code>20</code> 。前一个位置 <code>i-1</code> 必须是波谷（下降趋势，<code>k=0</code>）。</li>
<li><strong>方程</strong>: <code>dp[i][3][1] = max(dp[i-1][1][0], dp[i-1][2][0]) + pos[i].thirty</code></li>
</ul>
</li>
</ol>
<p><strong>不可达状态</strong>:</p>
<ul>
<li><code>dp[i][1][1]</code> (上升到最低点) 和 <code>dp[i][3][0]</code> (下降到最高点) 是不可能出现的。这些状态的值应保持为极小值，不参与计算。</li>
</ul>
<img src="/2025/10/25/Luogu-P1133-FlowerGardenDP/2.jpg" class="" title="手稿1">

<h4 id="实现"><a href="#实现" class="headerlink" title="实现"></a><strong>实现</strong></h4><p>该方案的实现直接从 <code>i=1</code> 循环到 <code>n</code>，并在最后取 <code>dp[n]</code> 所有合法状态的最大值作为结果。</p>
<img src="/2025/10/25/Luogu-P1133-FlowerGardenDP/3.png" class="" title="70分提交记录">

<p><a target="_blank" rel="noopener" href="https://www.luogu.com.cn/record/242568689">70分提交记录</a></p>
<details>
<summary>点击展开/折叠 V1.0 70分代码</summary>

<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="keyword">using</span> ll = <span class="type">long</span> <span class="type">long</span>;</span><br><span class="line">ll <span class="type">const</span> maxn = <span class="number">1e5</span> + <span class="number">5</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Plant_Position</span> &#123;</span><br><span class="line">    ll ten, twenty, thirty;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">ll n, dp[maxn][<span class="number">8</span>][<span class="number">7</span>];</span><br><span class="line">Plant_Position pos[maxn];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">dp_10_0</span><span class="params">(<span class="type">int</span> idx)</span> </span>&#123;</span><br><span class="line">    dp[idx][<span class="number">1</span>][<span class="number">0</span>] = <span class="built_in">max</span>(dp[idx - <span class="number">1</span>][<span class="number">2</span>][<span class="number">1</span>], dp[idx - <span class="number">1</span>][<span class="number">3</span>][<span class="number">1</span>]) + pos[idx].ten;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">dp_20_0</span><span class="params">(<span class="type">int</span> idx)</span> </span>&#123;</span><br><span class="line">    dp[idx][<span class="number">2</span>][<span class="number">0</span>] = dp[idx - <span class="number">1</span>][<span class="number">3</span>][<span class="number">1</span>] + pos[idx].twenty;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">dp_20_1</span><span class="params">(<span class="type">int</span> idx)</span> </span>&#123;</span><br><span class="line">    dp[idx][<span class="number">2</span>][<span class="number">1</span>] = dp[idx - <span class="number">1</span>][<span class="number">1</span>][<span class="number">0</span>] + pos[idx].twenty;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">dp_30_1</span><span class="params">(<span class="type">int</span> idx)</span> </span>&#123;</span><br><span class="line">    dp[idx][<span class="number">3</span>][<span class="number">1</span>] = <span class="built_in">max</span>(dp[idx - <span class="number">1</span>][<span class="number">1</span>][<span class="number">0</span>], dp[idx - <span class="number">1</span>][<span class="number">2</span>][<span class="number">0</span>]) + pos[idx].thirty;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">ll <span class="title">DP</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i++) &#123;</span><br><span class="line">        <span class="built_in">dp_10_0</span>(i);</span><br><span class="line">        <span class="built_in">dp_20_0</span>(i);</span><br><span class="line">        <span class="built_in">dp_20_1</span>(i);</span><br><span class="line">        <span class="built_in">dp_30_1</span>(i);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">max</span>(<span class="built_in">max</span>(dp[n][<span class="number">1</span>][<span class="number">0</span>], dp[n][<span class="number">3</span>][<span class="number">1</span>]), <span class="built_in">max</span>(dp[n][<span class="number">2</span>][<span class="number">0</span>], dp[n][<span class="number">2</span>][<span class="number">1</span>]));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    ios_base::<span class="built_in">sync_with_stdio</span>(<span class="literal">false</span>);</span><br><span class="line">    cin.<span class="built_in">tie</span>(<span class="literal">NULL</span>);</span><br><span class="line">    cin &gt;&gt; n;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i++) &#123;</span><br><span class="line">        cin &gt;&gt; pos[i].ten &gt;&gt; pos[i].twenty &gt;&gt; pos[i].thirty;</span><br><span class="line">    &#125;</span><br><span class="line">    cout &lt;&lt; <span class="built_in">DP</span>();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</details>

<h4 id="错误分析"><a href="#错误分析" class="headerlink" title="错误分析"></a><strong>错误分析</strong></h4><ul>
<li><strong>问题根源：</strong><br>该方案计算出的结果是 <strong>线性排列</strong> 下的最优解。但题目要求的是 <strong>环形排列</strong>。线性最优解的第 <code>n</code> 个位置和第 <code>1</code> 个位置的状态，很可能不满足高低交错的约束，因此该解对于环形问题是 <strong>非法的</strong>。</li>
</ul>
<h3 id="V2-0-“打补丁”的错误修正-90分"><a href="#V2-0-“打补丁”的错误修正-90分" class="headerlink" title="V2.0 “打补丁”的错误修正 (90分)"></a><strong>V2.0 “打补丁”的错误修正 (90分)</strong></h3><h4 id="设计-1"><a href="#设计-1" class="headerlink" title="设计"></a><strong>设计</strong></h4><p>在提交V1.0后，我意识到了环形约束的问题。此时产生了一个错误的修正思路：<strong>先算出线性最优，再检查它是否满足环形约束</strong>。</p>
<p>这个思路最初的实现是一个复杂且繁琐的 <code>while</code> 循环：</p>
<details>
<summary>点击展开/折叠 while“补丁”</summary>

<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">ans.<span class="built_in">push_back</span>(dp[n][<span class="number">1</span>][<span class="number">0</span>]);</span><br><span class="line">ans.<span class="built_in">push_back</span>(dp[n][<span class="number">2</span>][<span class="number">0</span>]);</span><br><span class="line">ans.<span class="built_in">push_back</span>(dp[n][<span class="number">2</span>][<span class="number">1</span>]);</span><br><span class="line">ans.<span class="built_in">push_back</span>(dp[n][<span class="number">3</span>][<span class="number">1</span>]);</span><br><span class="line"><span class="built_in">sort</span>(ans.<span class="built_in">begin</span>(), ans.<span class="built_in">end</span>());</span><br><span class="line"><span class="type">bool</span> y[<span class="number">5</span>] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line"><span class="keyword">while</span> (<span class="number">1</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (ans.<span class="built_in">back</span>() == dp[n][<span class="number">2</span>][<span class="number">0</span>] &amp;&amp; !y[<span class="number">0</span>]) &#123;</span><br><span class="line">        <span class="keyword">if</span> (pos[<span class="number">1</span>].twenty &lt; pos[<span class="number">1</span>].thirty) &#123;</span><br><span class="line">            cout &lt;&lt; ans.<span class="built_in">back</span>();</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            y[<span class="number">0</span>] = <span class="literal">true</span>;</span><br><span class="line">            ans.<span class="built_in">pop_back</span>();</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (ans.<span class="built_in">back</span>() == dp[n][<span class="number">2</span>][<span class="number">1</span>] &amp;&amp; !y[<span class="number">1</span>]) &#123;</span><br><span class="line">        <span class="keyword">if</span> (pos[<span class="number">1</span>].twenty &lt; pos[<span class="number">1</span>].ten) &#123;</span><br><span class="line">            cout &lt;&lt; ans.<span class="built_in">back</span>();</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            y[<span class="number">1</span>] = <span class="literal">true</span>;</span><br><span class="line">            ans.<span class="built_in">pop_back</span>();</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    cout &lt;&lt; ans.<span class="built_in">back</span>();</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</details>

<p>这个复杂的 <code>while</code> 最终被我精简为两个 <code>if</code> 语句：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (pos[<span class="number">1</span>].twenty &gt; pos[<span class="number">1</span>].ten) &#123;</span><br><span class="line">    dp[n][<span class="number">2</span>][<span class="number">1</span>] = <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (pos[<span class="number">1</span>].twenty &gt; pos[<span class="number">1</span>].thirty) &#123;</span><br><span class="line">    dp[n][<span class="number">2</span>][<span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line">cout &lt;&lt; <span class="built_in">max</span>(<span class="built_in">max</span>(dp[n][<span class="number">1</span>][<span class="number">0</span>], dp[n][<span class="number">3</span>][<span class="number">1</span>]), <span class="built_in">max</span>(dp[n][<span class="number">2</span>][<span class="number">0</span>], dp[n][<span class="number">2</span>][<span class="number">1</span>]));</span><br></pre></td></tr></table></figure>

<p><code>if</code> 虽比 <code>while</code> 精简了很多，其内在的错误逻辑是相同的。这个 <strong>“补丁”</strong> 的意图是，从线性DP算出的几个最优候选解中，通过一套逻辑来 <strong>推断</strong> 并 <strong>验证</strong> 起点是否合法。</p>
<p>其验证逻辑如下：</p>
<ol>
<li><p><strong>无约束情况</strong>：如果线性最优解的终点是 <code>dp[n][1][0]</code> ( <code>H=10</code> , 下降) 或 <code>dp[n][3][1]</code> ( <code>H=30</code> , 上升)，则直接接受。</p>
<ul>
<li><strong>推断</strong>: 如果 <code>H[n]=10</code>，则环要求 <code>H[1] &gt; 10</code>，即 <code>H[1]</code> 可以是 <code>20</code> 或 <code>30</code> 。因为有两个选择，代码便假设总能找到一个合法的起点，无需干预。<code>H[n]=30</code> 同理。</li>
</ul>
</li>
<li><p><strong>约束情况 1</strong>: 当考虑终点为 <code>dp[n][2][1]</code> ( <code>H=20</code> , 上升) 的路径时。</p>
<ul>
<li><strong>推断</strong>: 这个终点状态意味着 <code>H[n-1]=10</code>。为了构成环，<code>H[1]</code> 必须小于 <code>H[n]=20</code>，所以 <code>H[1]</code> <strong>必须是 <code>10</code></strong>。</li>
<li><strong>验证</strong>: 此时，代码进行一次 <strong>贪心</strong> 检查：<code>if (pos[1].twenty &gt; pos[1].ten)</code>。这个判断的逻辑是：“如果在起点上，种 <code>20</code> 的观赏价值比种 <code>10</code> 要高，那么一个真正最优的路径，当初在起点时就 <strong>不可能</strong> 选择种 <code>10</code> ”。基于这个贪心假设，如果条件成立，就认为这条要求起点为 <code>10</code> 的路径不可能是最优解，于是通过 <code>dp[n][2][1] = 0</code> 将其作废。</li>
</ul>
</li>
<li><p><strong>约束情况 2</strong>: 当考虑终点为 <code>dp[n][2][0]</code> ( <code>H=20</code> , 下降) 的路径时。</p>
<ul>
<li><strong>推断</strong>: 这个终点状态意味着 <code>H[n-1]=30</code>。为了构成环，<code>H[1]</code> 必须大于 <code>H[n]=20</code>，所以 <code>H[1]</code> <strong>必须是 <code>30</code></strong>。</li>
<li><strong>验证</strong>: 类似地，代码进行贪心检查 <code>if (pos[1].twenty &gt; pos[1].thirty)</code>。如果种 <code>20</code> 的价值更高，就认为这条要求起点为 <code>30</code> 的路径不可能是最优解，将其作废。</li>
</ul>
</li>
</ol>
<img src="/2025/10/25/Luogu-P1133-FlowerGardenDP/4.jpg" class="" title="手稿2">

<h4 id="实现-1"><a href="#实现-1" class="headerlink" title="实现"></a><strong>实现</strong></h4><img src="/2025/10/25/Luogu-P1133-FlowerGardenDP/5.png" class="" title="90分提交记录">

<p><a target="_blank" rel="noopener" href="https://www.luogu.com.cn/record/242583553">90分提交记录</a></p>
<details>
<summary>点击展开/折叠 V2.0 代码 (90分)</summary>

<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="keyword">using</span> ll = <span class="type">long</span> <span class="type">long</span>;</span><br><span class="line">ll <span class="type">const</span> maxn = <span class="number">1e5</span> + <span class="number">5</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Plant_Position</span> &#123;</span><br><span class="line">    ll ten, twenty, thirty;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">ll n, dp[maxn][<span class="number">8</span>][<span class="number">7</span>];</span><br><span class="line">Plant_Position pos[maxn];</span><br><span class="line">vector&lt;ll&gt; ans;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">dp_10_0</span><span class="params">(<span class="type">int</span> idx)</span> </span>&#123;</span><br><span class="line">    dp[idx][<span class="number">1</span>][<span class="number">0</span>] = <span class="built_in">max</span>(dp[idx - <span class="number">1</span>][<span class="number">2</span>][<span class="number">1</span>], dp[idx - <span class="number">1</span>][<span class="number">3</span>][<span class="number">1</span>]) + pos[idx].ten;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">dp_20_0</span><span class="params">(<span class="type">int</span> idx)</span> </span>&#123;</span><br><span class="line">    dp[idx][<span class="number">2</span>][<span class="number">0</span>] = dp[idx - <span class="number">1</span>][<span class="number">3</span>][<span class="number">1</span>] + pos[idx].twenty;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">dp_20_1</span><span class="params">(<span class="type">int</span> idx)</span> </span>&#123;</span><br><span class="line">    dp[idx][<span class="number">2</span>][<span class="number">1</span>] = dp[idx - <span class="number">1</span>][<span class="number">1</span>][<span class="number">0</span>] + pos[idx].twenty;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">dp_30_1</span><span class="params">(<span class="type">int</span> idx)</span> </span>&#123;</span><br><span class="line">    dp[idx][<span class="number">3</span>][<span class="number">1</span>] = <span class="built_in">max</span>(dp[idx - <span class="number">1</span>][<span class="number">1</span>][<span class="number">0</span>], dp[idx - <span class="number">1</span>][<span class="number">2</span>][<span class="number">0</span>]) + pos[idx].thirty;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">DP</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i++) &#123;</span><br><span class="line">        <span class="built_in">dp_10_0</span>(i);</span><br><span class="line">        <span class="built_in">dp_20_0</span>(i);</span><br><span class="line">        <span class="built_in">dp_20_1</span>(i);</span><br><span class="line">        <span class="built_in">dp_30_1</span>(i);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (pos[<span class="number">1</span>].twenty &gt; pos[<span class="number">1</span>].ten) &#123;</span><br><span class="line">        dp[n][<span class="number">2</span>][<span class="number">1</span>] = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (pos[<span class="number">1</span>].twenty &gt; pos[<span class="number">1</span>].thirty) &#123;</span><br><span class="line">        dp[n][<span class="number">2</span>][<span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    cout &lt;&lt; <span class="built_in">max</span>(<span class="built_in">max</span>(dp[n][<span class="number">1</span>][<span class="number">0</span>], dp[n][<span class="number">3</span>][<span class="number">1</span>]), <span class="built_in">max</span>(dp[n][<span class="number">2</span>][<span class="number">0</span>], dp[n][<span class="number">2</span>][<span class="number">1</span>]));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    ios_base::<span class="built_in">sync_with_stdio</span>(<span class="literal">false</span>);</span><br><span class="line">    cin.<span class="built_in">tie</span>(<span class="literal">NULL</span>);</span><br><span class="line">    cin &gt;&gt; n;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i++) &#123;</span><br><span class="line">        cin &gt;&gt; pos[i].ten &gt;&gt; pos[i].twenty &gt;&gt; pos[i].thirty;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">DP</span>();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

</details>

<h4 id="错误分析-1"><a href="#错误分析-1" class="headerlink" title="错误分析"></a><strong>错误分析</strong></h4><ul>
<li><p><strong>根本性缺陷：</strong><br>此方案的失败，并非因为 <code>if</code> 语句这个 <strong>补丁</strong> 本身不够精巧。恰恰相反，它很好地浓缩了前一版 <code>while</code> 循环的意图，是一个逻辑上很优质的补丁。</p>
<p>真正的错误出在算法的 <strong>根本设计</strong> 上。这种 <strong>事后补救</strong> 的方法，就相当于把一条通往错误方向的道路修得非常漂亮，但道路再好，也无法到达正确的终点。</p>
<p>其核心谬误在于，它错误地假设了 <strong>环形最优解一定包含在线性最优解之中</strong>。而事实上，真正的环形最优解，其线性部分可能根本不是最优的。代码只检查了少数几个 <strong>线性最优</strong> 的候选者，而真正的答案可能在第一次DP时，就因为在线性排列上得分不够高而被直接淘汰，永远没有机会被最后的 <code>if</code> 语句检查。这是一种典型的 <strong>局部最优陷阱</strong>。</p>
</li>
</ul>
<h3 id="V3-0-“破环成链”的正确解法-AC"><a href="#V3-0-“破环成链”的正确解法-AC" class="headerlink" title="V3.0 “破环成链”的正确解法 (AC)"></a><strong>V3.0 “破环成链”的正确解法 (AC)</strong></h3><h4 id="设计-2"><a href="#设计-2" class="headerlink" title="设计"></a><strong>设计</strong></h4><p>正确的做法是放弃 <strong>事后补救</strong>，采用处理环形问题的 <strong>标准范式——破环成链</strong>。</p>
<p>其核心思想是，将一个复杂的环形问题，分解为几个独立的、<strong>带有明确起始和结束约束</strong> 的线性问题。</p>
<p>具体方案是，通过一个外层循环，<strong>强制指定 <code>第 1 棵树</code> 的高度</strong>（分三种情况： <code>H=10</code> ,  <code>H=20</code> ,  <code>H=30</code> ）。对每种情况独立进行一次从2到n的线性DP，并在最后根据固定的起点，对终点 <code>dp[n]</code> 的状态进行合法性筛选。</p>
<img src="/2025/10/25/Luogu-P1133-FlowerGardenDP/6.jpg" class="" title="手稿3">

<h4 id="可行性分析"><a href="#可行性分析" class="headerlink" title="可行性分析"></a><strong>可行性分析</strong></h4><ul>
<li><strong>时间复杂度</strong>: 每次DP的计算量是 <code>O(n)</code>。总共进行3次独立的DP，所以总时间复杂度依然是 <code>O(n)</code>。</li>
<li><strong>空间复杂度</strong>: <code>O(n)</code>。</li>
<li><strong>结论</strong>: 方案高效可行。</li>
</ul>
<h4 id="实现-2"><a href="#实现-2" class="headerlink" title="实现"></a><strong>实现</strong></h4><img src="/2025/10/25/Luogu-P1133-FlowerGardenDP/7.png" class="" title="AC提交记录">

<p><a target="_blank" rel="noopener" href="https://www.luogu.com.cn/record/242678415">AC提交记录</a></p>
<details>
<summary>点击展开/折叠 V3.0 AC代码</summary>

<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="keyword">using</span> ll = <span class="type">long</span> <span class="type">long</span>;</span><br><span class="line">ll <span class="type">const</span> maxn = <span class="number">1e5</span> + <span class="number">5</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Plant_Position</span> &#123;</span><br><span class="line">    ll ten, twenty, thirty;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">ll n, dp[maxn][<span class="number">5</span>][<span class="number">5</span>], ans;</span><br><span class="line">Plant_Position pos[maxn];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">DP</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    ll ans = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= <span class="number">3</span>; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (i == <span class="number">1</span>) &#123;</span><br><span class="line">            dp[<span class="number">1</span>][<span class="number">1</span>][<span class="number">0</span>] = pos[<span class="number">1</span>].ten;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (i == <span class="number">2</span>) &#123;</span><br><span class="line">            dp[<span class="number">1</span>][<span class="number">2</span>][<span class="number">0</span>] = pos[<span class="number">1</span>].twenty, dp[<span class="number">1</span>][<span class="number">2</span>][<span class="number">1</span>] = pos[<span class="number">1</span>].twenty;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (i == <span class="number">3</span>) &#123;</span><br><span class="line">            dp[<span class="number">1</span>][<span class="number">3</span>][<span class="number">1</span>] = pos[<span class="number">1</span>].thirty;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">2</span>; i &lt;= n; i++) &#123;</span><br><span class="line">            dp[i][<span class="number">1</span>][<span class="number">0</span>] = <span class="built_in">max</span>(dp[i - <span class="number">1</span>][<span class="number">2</span>][<span class="number">1</span>], dp[i - <span class="number">1</span>][<span class="number">3</span>][<span class="number">1</span>]) + pos[i].ten;</span><br><span class="line">            dp[i][<span class="number">2</span>][<span class="number">0</span>] = dp[i - <span class="number">1</span>][<span class="number">3</span>][<span class="number">1</span>] + pos[i].twenty;</span><br><span class="line">            dp[i][<span class="number">2</span>][<span class="number">1</span>] = dp[i - <span class="number">1</span>][<span class="number">1</span>][<span class="number">0</span>] + pos[i].twenty;</span><br><span class="line">            dp[i][<span class="number">3</span>][<span class="number">1</span>] = <span class="built_in">max</span>(dp[i - <span class="number">1</span>][<span class="number">1</span>][<span class="number">0</span>], dp[i - <span class="number">1</span>][<span class="number">2</span>][<span class="number">0</span>]) + pos[i].thirty;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (i == <span class="number">1</span>) &#123;</span><br><span class="line">            ans = <span class="built_in">max</span>(ans, <span class="built_in">max</span>(dp[n][<span class="number">2</span>][<span class="number">1</span>], dp[n][<span class="number">3</span>][<span class="number">1</span>]));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (i == <span class="number">2</span>) &#123;</span><br><span class="line">            ans = <span class="built_in">max</span>(ans, <span class="built_in">max</span>(dp[n][<span class="number">1</span>][<span class="number">0</span>], dp[n][<span class="number">3</span>][<span class="number">1</span>]));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (i == <span class="number">3</span>) &#123;</span><br><span class="line">            ans = <span class="built_in">max</span>(ans, <span class="built_in">max</span>(dp[n][<span class="number">1</span>][<span class="number">0</span>], dp[n][<span class="number">2</span>][<span class="number">0</span>]));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">memset</span>(dp, <span class="number">0</span>, <span class="built_in">sizeof</span>(dp));</span><br><span class="line">    &#125;</span><br><span class="line">    cout &lt;&lt; ans;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    ios_base::<span class="built_in">sync_with_stdio</span>(<span class="literal">false</span>);</span><br><span class="line">    cin.<span class="built_in">tie</span>(<span class="literal">NULL</span>);</span><br><span class="line">    cin &gt;&gt; n;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i++) &#123;</span><br><span class="line">        cin &gt;&gt; pos[i].ten &gt;&gt; pos[i].twenty &gt;&gt; pos[i].thirty;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">DP</span>();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</details>

<ul>
<li><p><strong>实现细节剖析</strong><br>该方案的精髓在于，将环形约束从一个 <strong>事后检查</strong> 的难题，转化为了一个 <strong>顶层设计</strong> 的分类讨论。在固定了起点后，最后结算时对终点的筛选逻辑如下：</p>
<ol>
<li><p><strong>若起点  <code>H[1]=10</code>  (波谷)</strong>:</p>
<ul>
<li>为构成环，终点 <code>H[n]</code> 必须是波峰，且 <code>H[n] &gt; H[1]</code>。</li>
<li>合法终点状态：<code>dp[n][2][1]</code> ( <code>H=20</code> , 上升) 和 <code>dp[n][3][1]</code> ( <code>H=30</code> , 上升)。</li>
<li>候选答案: <code>max(dp[n][2][1], dp[n][3][1])</code></li>
</ul>
</li>
<li><p><strong>若起点  <code>H[1]=20</code>  (波峰或波谷)</strong>:</p>
<ul>
<li>为构成环，若 <code>H[n]</code> 是波峰，则 <code>H[n] &gt; H[1]</code>；若 <code>H[n]</code> 是波谷，则 <code>H[n] &lt; H[1]</code>。</li>
<li>合法终点状态：<code>dp[n][3][1]</code> ( <code>H=30</code> , 上升) 和 <code>dp[n][1][0]</code> ( <code>H=10</code> , 下降)。</li>
<li>候选答案: <code>max(dp[n][3][1], dp[n][1][0])</code></li>
</ul>
</li>
<li><p><strong>若起点  <code>H[1]=30</code>  (波峰)</strong>:</p>
<ul>
<li>为构成环，终点 <code>H[n]</code> 必须是波谷，且 <code>H[n] &lt; H[1]</code>。</li>
<li>合法终点状态：<code>dp[n][1][0]</code> ( <code>H=10</code> , 下降) 和 <code>dp[n][2][0]</code> ( <code>H=20</code> , 下降)。</li>
<li>候选答案: <code>max(dp[n][1][0], dp[n][2][0])</code></li>
</ul>
</li>
</ol>
<p>最终答案就是这三个候选答案中的最大值。这种精确的筛选保证了最终解的合法性。</p>
</li>
</ul>
<hr>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><ol>
<li><strong>问题建模是关键</strong>：正确识别并处理 <strong>环形</strong> 这一核心模型，是解决本题的钥匙。直接套用线性模型会导致从根本上偏离题意。</li>
<li><strong>警惕“打补丁”式的修正</strong>：当发现算法有漏洞时，复杂的 <strong>事后检查</strong> 逻辑往往是错误或不完备的。正确的做法是回到设计的起点，思考如何将约束从一开始就融入算法模型。</li>
<li><strong>掌握标准范式</strong>：<strong>破环成链</strong> 是解决几乎所有环形DP、环形数组问题的通用且强大的思想，必须熟练掌握。</li>
</ol>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2025/10/13/K-InversePairs/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="nine19een">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="nine19een's Blog">
      <meta itemprop="description" content="记录学习过程中的思考、题解与复盘">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content=" | nine19een's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2025/10/13/K-InversePairs/" class="post-title-link" itemprop="url">逆序k倍对·复盘</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2025-10-13 01:49:00 / 修改时间：03:38:12" itemprop="dateCreated datePublished" datetime="2025-10-13T01:49:00+08:00">2025-10-13</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E7%AE%97%E6%B3%95%E9%A2%98%E8%A7%A3-%E5%A4%8D%E7%9B%98/" itemprop="url" rel="index"><span itemprop="name">算法题解/复盘</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>本题同样由那位BUAA大佬分享。</p>
<p>不久前，我用<strong>树状数组</strong>解决了洛谷上的<a target="_blank" rel="noopener" href="https://www.luogu.com.cn/problem/P1908">逆序对模板题</a> 。因此，当我初见这道 <strong>逆序 k 倍对</strong> 时，第一反应便是：这一定是模板的变体，核心工具依然是那个熟悉的树状数组。然而，从模板代码到这道题的AC，并非简单的复制粘贴，而是一段充满思考的<strong>魔改</strong>之旅。本文旨在完整复盘，我是如何基于逆序对模板的思路，一步步识别问题差异、调整关键逻辑，最终将一份模板代码成功改造为本题的解答。</p>
<hr>
<h2 id="题目"><a href="#题目" class="headerlink" title="题目"></a>题目</h2><h3 id="题目描述"><a href="#题目描述" class="headerlink" title="题目描述"></a>题目描述</h3><p>给定一个序列 a₁, a₂, …, aₙ 和一个正整数 k，如果 <code>1 ≤ i &lt; j ≤ n</code> 且 <code>aᵢ &gt; k · aⱼ</code>，我们就将 <code>(i, j)</code> 称作一个<strong>逆序 k 倍对</strong>。请你计算序列中逆序 k 倍对的个数。</p>
<h3 id="输入格式"><a href="#输入格式" class="headerlink" title="输入格式"></a>输入格式</h3><p>第一行两个正整数 n, k (1 ≤ n ≤ 10⁵, 1 ≤ k ≤ 10)。<br>第二行 n 个正整数 a₁, a₂, …, aₙ (1 ≤ aᵢ &lt; 2³¹)。<br>为了提高区分度，对于得分占比 10% 的测试点，我们保证 1 ≤ n ≤ 100。</p>
<h3 id="输出格式"><a href="#输出格式" class="headerlink" title="输出格式"></a>输出格式</h3><p>一行一个非负整数，表示序列中逆序 k 倍对的个数。</p>
<h3 id="输入样例"><a href="#输入样例" class="headerlink" title="输入样例"></a>输入样例</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">5 2</span><br><span class="line">5 4 3 2 1</span><br></pre></td></tr></table></figure>

<h3 id="输出样例"><a href="#输出样例" class="headerlink" title="输出样例"></a>输出样例</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">4</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="题目分析"><a href="#题目分析" class="headerlink" title="题目分析"></a>题目分析</h2><p>首先肯定要从那道经典的<strong>逆序对</strong>模板题开始分析。它的问题是统计 <code>i &lt; j</code> 且 <code>a[i] &gt; a[j]</code> 的数对。我当时AC的思路是：</p>
<ul>
<li>从左到右遍历数组，对于每个数 <code>a[j]</code>。</li>
<li>利用树状数组，查询在它<strong>之前</strong>已经出现过的数中，有多少个<strong>大于</strong> <code>a[j]</code>。</li>
<li>将这些查询结果累加，就是答案。</li>
<li>查询结束后，再将 <code>a[j]</code> 本身的信息更新到树状数组中。</li>
</ul>
<p>当时的AC代码如下：</p>
<details>
<summary>点击展开/折叠 逆序对模板题AC代码</summary>

<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="keyword">using</span> ll = <span class="type">long</span> <span class="type">long</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> n;</span><br><span class="line">vector&lt;<span class="type">int</span>&gt;a, b;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">Lowbit</span><span class="params">(<span class="type">int</span> x)</span></span>&#123;</span><br><span class="line">	<span class="keyword">return</span> x &amp; -x;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">ll <span class="title">Sum</span><span class="params">(<span class="type">int</span> x, ll arr[])</span></span>&#123;</span><br><span class="line">	ll ansSUM = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">for</span>(<span class="type">int</span> i = x; i != <span class="number">0</span>; i -= <span class="built_in">Lowbit</span>(i))&#123;</span><br><span class="line">		ansSUM += arr[i];</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> ansSUM;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Update</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> add, <span class="type">int</span> size, ll arr[])</span></span>&#123;</span><br><span class="line">	<span class="keyword">for</span>(<span class="type">int</span> i = x; i &lt;= size; i += <span class="built_in">Lowbit</span>(i))&#123;</span><br><span class="line">		arr[i] += add;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">	cin &gt;&gt; n;</span><br><span class="line">	a.<span class="built_in">reserve</span>(n + <span class="number">5</span>);</span><br><span class="line">	b.<span class="built_in">reserve</span>(n + <span class="number">5</span>);</span><br><span class="line">	<span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i++)&#123;</span><br><span class="line">		<span class="type">int</span> num;</span><br><span class="line">		cin &gt;&gt; num;</span><br><span class="line">		a.<span class="built_in">push_back</span>(num);</span><br><span class="line">		b.<span class="built_in">push_back</span>(num);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">sort</span>(b.<span class="built_in">begin</span>(), b.<span class="built_in">end</span>());</span><br><span class="line">	b.<span class="built_in">erase</span>(<span class="built_in">unique</span>(b.<span class="built_in">begin</span>(), b.<span class="built_in">end</span>()), b.<span class="built_in">end</span>());</span><br><span class="line">	<span class="type">int</span> size = b.<span class="built_in">size</span>();</span><br><span class="line">	ll c[size + <span class="number">5</span>] = &#123;<span class="number">0</span>&#125;, ans[size + <span class="number">5</span>] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line">	<span class="type">int</span> cnt = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">for</span>(<span class="type">int</span> p : a)&#123;</span><br><span class="line">		cnt++;</span><br><span class="line">		<span class="type">int</span> idx = <span class="built_in">lower_bound</span>(b.<span class="built_in">begin</span>(), b.<span class="built_in">end</span>(), p) - b.<span class="built_in">begin</span>() + <span class="number">1</span>;</span><br><span class="line">		<span class="built_in">Update</span>(idx, <span class="number">1</span>, size, c);</span><br><span class="line">		<span class="built_in">Update</span>(idx, cnt - <span class="built_in">Sum</span>(idx, c), size, ans);</span><br><span class="line">	&#125;</span><br><span class="line">	cout &lt;&lt; <span class="built_in">Sum</span>(size, ans);</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</details>

<p>这个框架非常清晰。现在，面对<strong>k倍逆序对</strong>，唯一的不同点，就是判断条件从 <code>a[i] &gt; a[j]</code> 变成了 <code>a[i] &gt; k * a[j]</code>。</p>
<p>这意味着，我的改造也必须围绕这个变化点展开。当我遍历到 <code>a[j]</code> 时，我需要查询的不再是<strong>比 <code>a[j]</code> 大的数</strong>，而是<strong>比 <code>k * a[j]</code> 大的数</strong>。</p>
<p>这个看似微小的变化，却直接影响了算法的基石——<strong>离散化</strong>。在原模板中，我们只需要对数组 <code>a</code> 中的值进行离散化。但现在，为了能查询 <code>k * a[j]</code> 的相关信息，我们必须将所有可能作为查询边界的 <code>k * a[j]</code> 也一并纳入离散化的范围。</p>
<p>这就是从模板到AC的关键一步：<strong>识别出查询目标的变化，并相应地扩大离散化的集合</strong>。</p>
<hr>
<h2 id="算法设计及实现"><a href="#算法设计及实现" class="headerlink" title="算法设计及实现"></a><strong>算法设计及实现</strong></h2><p>我的整个解题过程，可以看作是对逆序对模板代码的一次<strong>定向升级</strong>。</p>
<h3 id="核心思路：模板的演进"><a href="#核心思路：模板的演进" class="headerlink" title="核心思路：模板的演进"></a><strong>核心思路：模板的演进</strong></h3><ol>
<li><p><strong>继承模板框架：</strong></p>
<ul>
<li>整体的算法流程完全继承自逆序对模板：<strong>遍历数组 -&gt; 查询贡献 -&gt; 更新数据 -&gt; 累加结果</strong>。</li>
<li>核心数据结构依然锁定为<strong>树状数组</strong>，因为它能高效地完成我们需要的<strong>单点更新</strong>和<strong>前缀和查询</strong>。</li>
<li>由于 <code>a[i]</code> 的值域依然很大，<strong>离散化</strong>这一前置步骤也必须保留。</li>
</ul>
</li>
<li><p><strong>定位改造核心：查询目标的变化</strong></p>
<ul>
<li>模板的查询逻辑是：<code>贡献 = 总数 - 小于等于a[j]的个数</code>。</li>
<li>本题的查询逻辑变为：<code>贡献 = 总数 - 小于等于k*a[j]的个数</code>。</li>
<li>这个<code>k*a[j]</code>就是本次改造需要处理的<strong>新元素</strong>。</li>
</ul>
</li>
<li><p><strong>升级离散化：</strong></p>
<ul>
<li><strong>模板</strong>：离散化集合仅包含 <code>&#123; a[1], a[2], ..., a[n] &#125;</code>。</li>
<li><strong>本题</strong>：离散化集合必须扩大，同时包含 <code>&#123; a[1], ..., a[n] &#125;</code> 和 <code>&#123; k*a[1], ..., k*a[n] &#125;</code>。因为树状数组的下标是基于离散化后的排名，我们既需要能<strong>更新</strong> <code>a[j]</code> 对应的排名，也需要能<strong>查询</strong> <code>k*a[j]</code> 对应的排名。将它们全部放入一个集合中进行离散化，才能建立统一的“度量衡”。</li>
</ul>
</li>
<li><p><strong>微调主逻辑</strong></p>
<ul>
<li>在主循环中，对于当前元素 <code>p</code> (即<code>a[j]</code>)：<ul>
<li>首先，找到 <code>p</code> 离散化后的排名 <code>idx</code>。</li>
<li>然后，找到 <code>k*p</code> 离散化后的排名 <code>idx2</code>。</li>
<li>计算贡献值：<code>ans += cnt - Sum(idx2, c)</code>。这里的 <code>cnt</code> 是已处理元素个数，<code>Sum(idx2, c)</code> 则是利用树状数组查到的、前面出现过且值小于等于 <code>k*p</code> 的元素个数。</li>
<li>最后，执行和模板完全一样的更新操作：<code>Update(idx, 1, size, c)</code>，将 <code>p</code> 的出现次数记录到树状数组中。</li>
</ul>
</li>
</ul>
</li>
</ol>
<h3 id="可行性分析"><a href="#可行性分析" class="headerlink" title="可行性分析"></a><strong>可行性分析</strong></h3><p>这次“魔改”并没有改变算法的根本结构。</p>
<ul>
<li><p><strong>时间复杂度:</strong></p>
<ul>
<li>离散化集合的大小最多变为 <code>2n</code>。排序的复杂度依然是 <code>O(n log n)</code>。</li>
<li>主循环中，树状数组和 <code>lower_bound</code> 的操作复杂度仍为 <code>O(log n)</code>。</li>
<li>总时间复杂度保持在 <strong><code>O(n log n)</code></strong>，完全可以通过。</li>
</ul>
</li>
<li><p><strong>空间复杂度:</strong></p>
<ul>
<li>辅助数组 <code>b</code> 和树状数组 <code>c</code> 的大小变为原来的两倍左右，空间复杂度依然是 <strong><code>O(n)</code></strong>。</li>
</ul>
</li>
<li><p><strong>结论：</strong><br>通过精准地定位差异并对离散化这一关键步骤进行升级，我们成功地将逆序对模板适配到了新问题上，<strong>方案高效可行</strong>。</p>
</li>
</ul>
<h3 id="实现"><a href="#实现" class="headerlink" title="实现"></a><strong>实现</strong></h3><p>最终的AC代码，清晰地保留了逆序对模板的骨架，但在离散化的部分，能明显看到为了适应新规则而做的扩展。</p>
<details>
<summary>点击展开/折叠 最终AC代码</summary>

<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="keyword">using</span> ll = <span class="type">long</span> <span class="type">long</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> n, k;</span><br><span class="line">ll ans;</span><br><span class="line">vector&lt;<span class="type">int</span>&gt;a, b;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">Lowbit</span><span class="params">(<span class="type">int</span> x)</span></span>&#123;</span><br><span class="line">	<span class="keyword">return</span> x &amp; -x;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">ll <span class="title">Sum</span><span class="params">(<span class="type">int</span> x, ll arr[])</span></span>&#123;</span><br><span class="line">	ll ansSUM = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">for</span>(<span class="type">int</span> i = x; i != <span class="number">0</span>; i -= <span class="built_in">Lowbit</span>(i))&#123;</span><br><span class="line">		ansSUM += arr[i];</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> ansSUM;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Update</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> add, <span class="type">int</span> size, ll arr[])</span></span>&#123;</span><br><span class="line">	<span class="keyword">for</span>(<span class="type">int</span> i = x; i &lt;= size; i += <span class="built_in">Lowbit</span>(i))&#123;</span><br><span class="line">		arr[i] += add;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">	ios_base::<span class="built_in">sync_with_stdio</span>(<span class="literal">false</span>);</span><br><span class="line">	cin.<span class="built_in">tie</span>(<span class="literal">NULL</span>);</span><br><span class="line">	cin &gt;&gt; n &gt;&gt; k;</span><br><span class="line">	a.<span class="built_in">reserve</span>(n + <span class="number">5</span>);</span><br><span class="line">	b.<span class="built_in">reserve</span>(<span class="number">2</span> * n + <span class="number">5</span>);</span><br><span class="line">	<span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i++)&#123;</span><br><span class="line">		<span class="type">int</span> num;</span><br><span class="line">		cin &gt;&gt; num;</span><br><span class="line">		a.<span class="built_in">push_back</span>(num);</span><br><span class="line">		b.<span class="built_in">push_back</span>(num);</span><br><span class="line">		b.<span class="built_in">push_back</span>(k * num);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">sort</span>(b.<span class="built_in">begin</span>(), b.<span class="built_in">end</span>());</span><br><span class="line">	b.<span class="built_in">erase</span>(<span class="built_in">unique</span>(b.<span class="built_in">begin</span>(), b.<span class="built_in">end</span>()), b.<span class="built_in">end</span>());</span><br><span class="line">	<span class="type">int</span> size = b.<span class="built_in">size</span>();</span><br><span class="line">	ll c[size + <span class="number">5</span>] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line">	ll cnt = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">for</span>(<span class="type">int</span> p : a)&#123;</span><br><span class="line">		cnt++;</span><br><span class="line">		<span class="type">int</span> idx = <span class="built_in">lower_bound</span>(b.<span class="built_in">begin</span>(), b.<span class="built_in">end</span>(), p) - b.<span class="built_in">begin</span>() + <span class="number">1</span>;</span><br><span class="line">		<span class="type">int</span> idx2 = <span class="built_in">lower_bound</span>(b.<span class="built_in">begin</span>(), b.<span class="built_in">end</span>(), p * k) - b.<span class="built_in">begin</span>() + <span class="number">1</span>;</span><br><span class="line">		<span class="built_in">Update</span>(idx, <span class="number">1</span>, size, c);</span><br><span class="line">		ans += cnt - <span class="built_in">Sum</span>(idx2, c);</span><br><span class="line">	&#125;</span><br><span class="line">	cout &lt;&lt; ans;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</details>

<hr>
<h2 id="代码对比"><a href="#代码对比" class="headerlink" title="代码对比"></a>代码对比</h2><p>整个改造过程实际只涉及两个关键环节。</p>
<h3 id="1-扩展离散化集合"><a href="#1-扩展离散化集合" class="headerlink" title="1. 扩展离散化集合"></a>1. 扩展离散化集合</h3><p><strong>模板代码</strong>：仅收集原数组中的值。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 离散化集合 b 只需包含 a 内的值</span></span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i++)&#123;</span><br><span class="line">    <span class="type">int</span> num;</span><br><span class="line">    cin &gt;&gt; num;</span><br><span class="line">    a.<span class="built_in">push_back</span>(num);</span><br><span class="line">    b.<span class="built_in">push_back</span>(num);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>本题代码</strong>：同时收集原数值与其 <code>k</code> 倍值。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 离散化集合 b 必须同时包含 a 内的值及其 k 倍</span></span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i++)&#123;</span><br><span class="line">    ll num;</span><br><span class="line">    cin &gt;&gt; num;</span><br><span class="line">    a.<span class="built_in">push_back</span>(num);</span><br><span class="line">    b.<span class="built_in">push_back</span>(num);</span><br><span class="line">    b.<span class="built_in">push_back</span>(k * num); <span class="comment">// 【改动】为查询 k*p 预作准备</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>原因</strong>：树状数组需要查询 <code>k*p</code> 的排名，因此必须在一开始就将所有可能的 <code>k*p</code> 值纳入离散化，以建立统一的排名体系。</p>
<h3 id="2-变更查询边界"><a href="#2-变更查询边界" class="headerlink" title="2. 变更查询边界"></a>2. 变更查询边界</h3><p><strong>模板代码</strong>：查询大于 <code>p</code> 的元素个数。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span>(<span class="type">int</span> p : a)&#123;</span><br><span class="line">    <span class="comment">// 查询和更新都使用 p 自身的排名</span></span><br><span class="line">    <span class="type">int</span> idx = <span class="built_in">lower_bound</span>(b.<span class="built_in">begin</span>(), b.<span class="built_in">end</span>(), p) - b.<span class="built_in">begin</span>() + <span class="number">1</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 查询边界是 p 本身</span></span><br><span class="line">    ans += cnt - <span class="built_in">Sum</span>(idx, c);</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">Update</span>(idx, <span class="number">1</span>, size, c);</span><br><span class="line">    cnt++;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>本题代码</strong>：查询大于 <code>k*p</code> 的元素个数。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span>(ll p : a)&#123;</span><br><span class="line">    <span class="comment">// 更新时用 p 的排名</span></span><br><span class="line">    <span class="type">int</span> idx = <span class="built_in">lower_bound</span>(b.<span class="built_in">begin</span>(), b.<span class="built_in">end</span>(), p) - b.<span class="built_in">begin</span>() + <span class="number">1</span>;</span><br><span class="line">    <span class="comment">// 【改动】计算新的查询边界 k*p 的排名</span></span><br><span class="line">    <span class="type">int</span> idx2 = <span class="built_in">lower_bound</span>(b.<span class="built_in">begin</span>(), b.<span class="built_in">end</span>(), p * k) - b.<span class="built_in">begin</span>() + <span class="number">1</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 【改动】使用新的排名 idx2 进行查询</span></span><br><span class="line">    ans += cnt - <span class="built_in">Sum</span>(idx2, c);</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">Update</span>(idx, <span class="number">1</span>, size, c);</span><br><span class="line">    cnt++;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>原因</strong>：题目的核心条件从 <code>&gt; p</code> 变为 <code>&gt; k*p</code>，因此计算贡献时，传入 <code>Sum</code> 函数的参数，必须是 <code>k*p</code> 对应的排名，而非 <code>p</code> 的排名。</p>
<hr>
<p><strong>P.S.</strong> 例行在最后放上做题手稿</p>
<img src="/2025/10/13/K-InversePairs/1.jpg" class="" title="做题手稿">

<hr>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><ol>
<li><strong>模型识别与套用</strong>：将新问题关联到已知的算法模型（本题的<strong>逆序对模板</strong>），以此为基础快速构建解题框架。</li>
<li><strong>分析核心差异</strong>：精准定位问题变体的关键不同点。本题的核心差异在于判断条件从 <code>a[i] &gt; a[j]</code> 变更为 <code>a[i] &gt; k * a[j]</code>。</li>
<li><strong>模块化调整</strong>：根据核心差异，修改算法中受影响的模块。此题中，查询条件的变更，直接决定了<strong>离散化</strong>的数据集合必须相应地扩展。</li>
<li><strong>理解功能而非形式</strong>：掌握算法中每个模块的<strong>功能目的</strong>是解决问题的关键。这使得我们能根据问题变化，对模板进行有效调整，而不是进行无效的生搬硬套。</li>
</ol>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2025/10/12/LilacFractal/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="nine19een">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="nine19een's Blog">
      <meta itemprop="description" content="记录学习过程中的思考、题解与复盘">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content=" | nine19een's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2025/10/12/LilacFractal/" class="post-title-link" itemprop="url">丁香花分形·复盘——从递推关系中洞悉分形之美</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2025-10-12 03:05:52 / 修改时间：03:24:30" itemprop="dateCreated datePublished" datetime="2025-10-12T03:05:52+08:00">2025-10-12</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E7%AE%97%E6%B3%95%E9%A2%98%E8%A7%A3-%E5%A4%8D%E7%9B%98/" itemprop="url" rel="index"><span itemprop="name">算法题解/复盘</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>本题由某位BUAA大佬分享。</p>
<p>初见这道图形题时，我被其酷似分形的演变过程所吸引。它看似是一个纯粹的图形模拟题，但随着操作次数 <code>n</code> 的增加，图形的尺寸和复杂性都呈爆炸式增长，让我意识到简单的暴力绘制绝非正解。本文旨在复盘我如何从繁杂的图形变化中发现并实现一个精妙的递推关系，最终优雅地解决这个问题的全过程。</p>
<hr>
<h2 id="题目"><a href="#题目" class="headerlink" title="题目"></a>题目</h2><h3 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h3><p>丁香花通常由四片花瓣组成，四片花瓣的位置关系可以简要用图1表示。</p>
<p>单单四个正方形显然还不能表达丁香花的魅力，因此我们将该图形进行<strong>一次操作</strong>，包含以下两个步骤：</p>
<ol>
<li>将图形重复4次，如图2所示；</li>
<li>将图形旋转45度，如图3所示。</li>
</ol>
<p>我们将上述两个步骤整体称为<strong>一次操作</strong>。在图3基础上再重复一次操作，我们就能得到图4。</p>
<table>
<thead>
<tr>
<th align="center"></th>
<th align="center"></th>
<th align="center"></th>
<th align="center"></th>
</tr>
</thead>
<tbody><tr>
<td align="center"><img src="/2025/10/12/LilacFractal/111.png" class="" title="图1"></td>
<td align="center"><img src="/2025/10/12/LilacFractal/222.png" class="" title="图2"></td>
<td align="center"><img src="/2025/10/12/LilacFractal/333.png" class="" title="图3"></td>
<td align="center"><img src="/2025/10/12/LilacFractal/444.png" class="" title="图4"></td>
</tr>
<tr>
<td align="center"><strong>图1</strong>: 基础图形</td>
<td align="center"><strong>图2</strong>: 基础图形重复四次</td>
<td align="center"><strong>图3</strong>: 进行一次操作后</td>
<td align="center"><strong>图4</strong>: 进行两次操作后</td>
</tr>
</tbody></table>
<h3 id="描述"><a href="#描述" class="headerlink" title="描述"></a>描述</h3><p>本题需要你编程绘出进行了 <code>n</code> 次操作后的图形（注意：<strong>基础图形</strong>为进行了 <strong>0 次</strong>操作的图形）。</p>
<p>输出时，图形中有正方形的位置输出一个字符 <code>o</code>，没有正方形的位置输出一个空格 <code> </code>。行末的空格可以忽略。</p>
<p>例如，对于<strong>图1</strong> (<code>n=0</code>)，应该输出为：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">  o</span><br><span class="line">o   o</span><br><span class="line">  o</span><br></pre></td></tr></table></figure>

<p>又如，对于<strong>图4</strong> (<code>n=2</code>)，应该输出为：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">            o     o</span><br><span class="line">          o   o o   o</span><br><span class="line">            o     o</span><br><span class="line">            o     o</span><br><span class="line">          o   o o   o</span><br><span class="line">  o     o   o     o   o     o</span><br><span class="line">o   o o   o         o   o o   o</span><br><span class="line">  o     o             o     o</span><br><span class="line">  o     o             o     o</span><br><span class="line">o   o o   o         o   o o   o</span><br><span class="line">  o     o   o     o   o     o</span><br><span class="line">          o   o o   o</span><br><span class="line">            o     o</span><br><span class="line">            o     o</span><br><span class="line">          o   o o   o</span><br><span class="line">            o     o</span><br></pre></td></tr></table></figure>

<h3 id="输入"><a href="#输入" class="headerlink" title="输入"></a>输入</h3><p>输入一个非负整数 <code>n</code>，表示操作的次数。</p>
<p>数据保证 <code>0 &lt;= n &lt;= 6</code>。</p>
<h3 id="输出"><a href="#输出" class="headerlink" title="输出"></a>输出</h3><p>输出经过 <code>n</code> 次操作后对应的图形。</p>
<p><strong>特别注意</strong>：为了方便在控制台进行输出，当操作次数 <code>n</code> 为<strong>奇数</strong>时，请将图形<strong>旋转45度再输出</strong>。</p>
<h3 id="输入样例"><a href="#输入样例" class="headerlink" title="输入样例"></a>输入样例</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1</span><br></pre></td></tr></table></figure>

<h3 id="输出样例"><a href="#输出样例" class="headerlink" title="输出样例"></a>输出样例</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">  o     o</span><br><span class="line">o   o o   o</span><br><span class="line">  o     o</span><br><span class="line">  o     o</span><br><span class="line">o   o o   o</span><br><span class="line">  o     o</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="题目分析"><a href="#题目分析" class="headerlink" title="题目分析"></a>题目分析</h2><p>理解题目后，我们可以将<strong>一次操作</strong>分解为两个基本步骤的组合：</p>
<ol>
<li><strong>膨胀</strong>：将当前图形作为单元，无重叠地平铺成一个 2x2 的更大图形。</li>
<li><strong>重组</strong>：将膨胀后得到的四个象限进行有重叠的重新排列，形成类似<strong>旋转45度</strong>的视觉效果。</li>
</ol>
<p>直接模拟这个过程的难点在于<strong>第二步（重组）</strong>。每次重组后，新图形的边长是多少？四个象限应该放置在哪个精确的坐标上？这些参数的变化并非线性，如果不能找到其规律，算法将无从下手。因此，整个问题的核心，从<strong>如何画图</strong>转变成了<strong>如何计算每一步操作的画布尺寸与布局坐标</strong>。</p>
<p>我的解法选择了一个迭代的思路，从 <code>n=0</code> 的基础图形出发，循环 <code>n</code> 次，每次迭代生成下一阶段的图形。这个迭代过程并非一成不变，而是根据迭代次数的奇偶，执行两种截然不同的生成逻辑。</p>
<hr>
<h2 id="算法设计及实现"><a href="#算法设计及实现" class="headerlink" title="算法设计及实现"></a><strong>算法设计及实现</strong></h2><p>我的算法将题目中抽象的“一次操作”，具象化为一次<strong>奇数步膨胀</strong>和一次<strong>偶数步重组</strong>的交替执行。通过一个 <code>for</code> 循环，我们模拟 <code>n</code> 次这样的交替演变，最终得到目标图形。</p>
<h3 id="核心思路：奇偶交替的迭代生成"><a href="#核心思路：奇偶交替的迭代生成" class="headerlink" title="核心思路：奇偶交替的迭代生成"></a><strong>核心思路：奇偶交替的迭代生成</strong></h3><p>我们用一个 <code>for</code> 循环从 <code>i=1</code> 到 <code>n</code> 进行迭代，其中 <code>i</code> 代表当前是第几次演变。</p>
<ol>
<li><p><strong>当 <code>i</code> 为奇数时：膨胀阶段</strong></p>
<ul>
<li><strong>任务</strong>：执行纯粹的复制与放大。</li>
<li><strong>实现</strong>：我们将上一步（<code>i-1</code>）得到的完整图形（记为 <code>temp</code>）视为一个“瓦片”。然后，在一个尺寸为 <code>a_temp * 2</code> 的新画布（记为 <code>pic</code>）上，将这个瓦片无重叠地铺满 <code>pic</code> 的四个象限。这一步非常直观，图形的结构不变，只是尺寸翻倍。</li>
</ul>
</li>
<li><p><strong>当 <code>i</code> 为偶数时：重组阶段</strong></p>
<ul>
<li><strong>任务</strong>：执行复杂的重叠与收缩。</li>
<li><strong>实现</strong>：这一步处理的是奇数阶段生成的、由四个象限组成的膨胀图形。我们将这四个“瓦片”重新排列，将它们分别放置在新画布的<strong>上、下、左、右</strong>四个方位，形成一个中心重叠的十字形状。</li>
<li><strong>难点</strong>：新画布的尺寸 <code>a_pic</code> 以及四个“瓦片”的精确放置坐标，是这一步的关键。通过观察和推演，我发现了一个至关重要的递推规律。</li>
</ul>
</li>
</ol>
<h3 id="关键发现：b-i-3-递推规律"><a href="#关键发现：b-i-3-递推规律" class="headerlink" title="关键发现：b[i-3] 递推规律"></a><strong>关键发现：<code>b[i-3]</code> 递推规律</strong></h3><p>在重组阶段，各项参数的计算并非无迹可寻。我发现，当进行第 <code>i</code> 次演变（<code>i</code> 为偶数且 <code>i &gt;= 4</code>）时，新画布的尺寸以及重叠的深度，都与<strong>第 <code>i-3</code> 次演变完成时的画布边长 <code>b[i-3]</code></strong> 存在一个确定的数学关系。</p>
<p>下图为做题时的手绘示意图，可供直观理解：</p>
<img src="/2025/10/12/LilacFractal/2.jpg" class="" title="草稿">

<ul>
<li><p><strong>新画布尺寸 <code>a_pic</code> 的计算 (<code>update_a</code> 函数):</strong><br><code>a_pic(i) = a_pic(i-1) + (a_pic(i-1) - b[i-3]) * 2</code><br>这里的 <code>a_pic(i-1)</code> 是上一个奇数膨胀阶段的边长。这个公式描述了新画布如何在上一阶段的基础上，根据 <code>i-3</code> 步的历史状态进行扩张。</p>
</li>
<li><p><strong>布局坐标的计算 (<code>draw</code> 函数):</strong><br>在 <code>draw</code> 函数中，放置“瓦片”的起始坐标偏移量，也由 <code>b[i-3]</code> 决定。例如，左侧瓦片的 <code>y</code> 坐标和上方瓦片的 <code>x</code> 坐标，都涉及到一个关键偏移量：<code>a_temp - (b[i - 3] - 1)</code>，其中 <code>a_temp</code> 是 <code>a_pic(i-1)</code>。</p>
</li>
</ul>
<p>这个递推关系，正是图形演变过程的关键。它将一个复杂的几何问题，转化为了一个可以通过历史数据精确计算的数学问题。<code>i=2</code> 的情况由于 <code>i-3</code> 无意义，需要作为特殊情况单独处理。</p>
<h3 id="可行性分析"><a href="#可行性分析" class="headerlink" title="可行性分析"></a><strong>可行性分析</strong></h3><ul>
<li><p><strong>时间复杂度:</strong></p>
<ul>
<li>外层循环执行 <code>n</code> 次。在每次循环内部，核心操作是 <code>draw</code> 函数，它本质上是数组的复制，复杂度为 <code>O(a_temp^2)</code>。</li>
<li>画布边长 <code>a_pic</code> 大致以 <code>2*sqrt(2)</code> 为公比的等比数列增长（奇数步<code>*2</code>，偶数步<code>*sqrt(2)</code>左右）。当 <code>n</code> 较小时，<code>a_pic</code> 的增长在可控范围内，对于题目数据范围，总计算量可以接受。</li>
</ul>
</li>
<li><p><strong>空间复杂度:</strong></p>
<ul>
<li>我们需要 <code>pic</code> 和 <code>temp</code> 两个二维数组来存储图形，其大小由最终的 <code>a_pic</code> 决定。空间复杂度为 <code>O(a_pic^2)</code>。</li>
</ul>
</li>
<li><p><strong>结论：</strong><br>该算法将复杂的图形生成问题转化为迭代计算，通过发现递推规律避免了复杂的几何推导，<strong>方案可行</strong>。</p>
</li>
</ul>
<h3 id="实现"><a href="#实现" class="headerlink" title="实现"></a><strong>实现</strong></h3><p>基于以上思路，我构建了最终的AC代码。它通过 <code>pic</code> 和 <code>temp</code> 两个数组作为双缓冲，交替进行图形的生成和暂存，并通过 <code>update_a</code> 和 <code>draw</code> 函数，精确实现了奇偶交替的演变逻辑。</p>
<details>
<summary>点击展开/折叠 最终AC代码</summary>

<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">int</span> <span class="type">const</span> maxn = <span class="number">1e3</span> + <span class="number">5</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> n, a_pic = <span class="number">3</span>, a_temp = <span class="number">3</span>, b[<span class="number">10</span>];</span><br><span class="line"><span class="type">char</span> pic[maxn][maxn];</span><br><span class="line"><span class="type">char</span> temp[maxn][maxn];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">isEven</span><span class="params">(<span class="type">int</span> num)</span></span>&#123;</span><br><span class="line">	<span class="keyword">return</span> !(num &amp; <span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">draw</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y)</span></span>&#123;</span><br><span class="line">	<span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">1</span>; i &lt;= a_temp; ++i)&#123;</span><br><span class="line">		<span class="keyword">for</span>(<span class="type">int</span> j = <span class="number">1</span>; j &lt;= a_temp; ++j)&#123;</span><br><span class="line">			<span class="keyword">if</span>(pic[x + i - <span class="number">1</span>][y + j - <span class="number">1</span>] != <span class="string">&#x27;o&#x27;</span>)&#123;</span><br><span class="line">				pic[x + i - <span class="number">1</span>][y + j - <span class="number">1</span>] = temp[i][j];</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">update_a</span><span class="params">(<span class="type">int</span> x)</span></span>&#123;</span><br><span class="line">	<span class="keyword">if</span>(!<span class="built_in">isEven</span>(x))&#123;</span><br><span class="line">		a_pic *= <span class="number">2</span>;</span><br><span class="line">		b[x] = a_pic;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">else</span>&#123;</span><br><span class="line">		<span class="keyword">if</span>(x == <span class="number">2</span>)&#123;</span><br><span class="line">			a_pic = a_temp * <span class="number">3</span> - <span class="number">2</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span>&#123;</span><br><span class="line">			a_pic = a_pic + (a_pic - b[x - <span class="number">3</span>]) * <span class="number">2</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">update_temp</span><span class="params">()</span></span>&#123;</span><br><span class="line">	<span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">1</span>; i &lt;= a_pic; ++i)&#123;</span><br><span class="line">		<span class="keyword">for</span>(<span class="type">int</span> j = <span class="number">1</span>; j &lt;= a_pic; ++j)&#123;</span><br><span class="line">			<span class="keyword">if</span> (pic[i][j] == <span class="number">0</span>) &#123;</span><br><span class="line">				pic[i][j] = <span class="string">&#x27; &#x27;</span>;</span><br><span class="line">			&#125;</span><br><span class="line">			temp[i][j] = pic[i][j];</span><br><span class="line">		&#125;	</span><br><span class="line">	&#125;</span><br><span class="line">	a_temp = a_pic;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">	ios_base::<span class="built_in">sync_with_stdio</span>(<span class="literal">false</span>);</span><br><span class="line">	cin.<span class="built_in">tie</span>(<span class="literal">NULL</span>);</span><br><span class="line">	temp[<span class="number">1</span>][<span class="number">1</span>] = <span class="string">&#x27; &#x27;</span>, temp[<span class="number">1</span>][<span class="number">2</span>] = <span class="string">&#x27;o&#x27;</span>, temp[<span class="number">1</span>][<span class="number">3</span>] = <span class="string">&#x27; &#x27;</span>, temp[<span class="number">2</span>][<span class="number">1</span>] = <span class="string">&#x27;o&#x27;</span>, temp[<span class="number">2</span>][<span class="number">2</span>] = <span class="string">&#x27; &#x27;</span>, temp[<span class="number">2</span>][<span class="number">3</span>] = <span class="string">&#x27;o&#x27;</span>, temp[<span class="number">3</span>][<span class="number">1</span>] = <span class="string">&#x27; &#x27;</span>, temp[<span class="number">3</span>][<span class="number">2</span>] = <span class="string">&#x27;o&#x27;</span>, temp[<span class="number">3</span>][<span class="number">3</span>] = <span class="string">&#x27; &#x27;</span>;</span><br><span class="line">	cin &gt;&gt; n;</span><br><span class="line">	<span class="keyword">if</span>(n == <span class="number">0</span>)&#123;</span><br><span class="line">		<span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">1</span>; i &lt;= <span class="number">3</span>; ++i)&#123;</span><br><span class="line">			<span class="keyword">for</span>(<span class="type">int</span> j = <span class="number">1</span>; j &lt;= <span class="number">3</span>; ++j)&#123;</span><br><span class="line">				cout &lt;&lt; <span class="string">&quot; &quot;</span> &lt;&lt; temp[i][j];</span><br><span class="line">			&#125;</span><br><span class="line">			cout &lt;&lt; <span class="string">&#x27;\n&#x27;</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">	&#125; </span><br><span class="line">	<span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; ++i)&#123;</span><br><span class="line">		<span class="built_in">update_a</span>(i);</span><br><span class="line">		<span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">1</span>; j &lt;= a_temp; ++j) &#123;</span><br><span class="line">			<span class="built_in">memset</span>(pic[j], <span class="number">0</span>, <span class="keyword">sizeof</span> pic[j]);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span>(!<span class="built_in">isEven</span>(i))&#123;</span><br><span class="line">			<span class="built_in">draw</span>(<span class="number">1</span>, <span class="number">1</span>);</span><br><span class="line">			<span class="built_in">draw</span>(<span class="number">1</span>, <span class="number">1</span> + a_temp);</span><br><span class="line">			<span class="built_in">draw</span>(<span class="number">1</span> + a_temp, <span class="number">1</span>);</span><br><span class="line">			<span class="built_in">draw</span>(<span class="number">1</span> + a_temp, <span class="number">1</span> + a_temp);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span>&#123;</span><br><span class="line">			<span class="keyword">if</span>(i == <span class="number">2</span>)&#123;</span><br><span class="line">				<span class="built_in">draw</span>(<span class="number">1</span>, a_temp);</span><br><span class="line">				<span class="built_in">draw</span>(a_temp, <span class="number">1</span>);</span><br><span class="line">				<span class="built_in">draw</span>(a_temp, <span class="number">2</span> * a_temp - <span class="number">1</span>);</span><br><span class="line">				<span class="built_in">draw</span>(<span class="number">2</span> * a_temp - <span class="number">1</span>, a_temp);</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">else</span>&#123;</span><br><span class="line">				<span class="built_in">draw</span>(<span class="number">1</span>, a_temp - (b[i - <span class="number">3</span>] - <span class="number">1</span>));</span><br><span class="line">				<span class="built_in">draw</span>(a_temp - (b[i - <span class="number">3</span>] - <span class="number">1</span>), <span class="number">1</span>);</span><br><span class="line">				<span class="built_in">draw</span>(a_temp - (b[i - <span class="number">3</span>] - <span class="number">1</span>), <span class="number">2</span> * a_temp - (<span class="number">2</span> * b[i - <span class="number">3</span>] - <span class="number">1</span>));</span><br><span class="line">				<span class="built_in">draw</span>(<span class="number">2</span> * a_temp - (<span class="number">2</span> * b[i - <span class="number">3</span>] - <span class="number">1</span>), a_temp - (b[i - <span class="number">3</span>] - <span class="number">1</span>));</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="built_in">update_temp</span>();</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">1</span>; i &lt;= a_pic; ++i)&#123;</span><br><span class="line">		<span class="keyword">for</span>(<span class="type">int</span> j = <span class="number">1</span>; j &lt;= a_pic; ++j)&#123;</span><br><span class="line">			cout &lt;&lt; <span class="string">&quot; &quot;</span> &lt;&lt; pic[i][j];</span><br><span class="line">		&#125;</span><br><span class="line">		cout &lt;&lt; <span class="string">&#x27;\n&#x27;</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</details>

<h3 id="各阶段图形演变"><a href="#各阶段图形演变" class="headerlink" title="各阶段图形演变"></a>各阶段图形演变</h3><p>为了直观地展示算法的最终效果以及图形的演变之美，以下是 <code>n=0</code> 到 <code>n=6</code> 的完整输出图形。</p>
<details>
<summary>点击展开/折叠 n=0 的输出图形</summary>

<img src="/2025/10/12/LilacFractal/n0_output.png" class="" title="n&#x3D;0 输出">

</details>

<details>
<summary>点击展开/折叠 n=1 的输出图形</summary>

<img src="/2025/10/12/LilacFractal/n1_output.png" class="" title="n&#x3D;1 输出">

</details>

<details>
<summary>点击展开/折叠 n=2 的输出图形</summary>

<img src="/2025/10/12/LilacFractal/n2_output.png" class="" title="n&#x3D;2 输出">

</details>

<details>
<summary>点击展开/折叠 n=3 的输出图形</summary>

<img src="/2025/10/12/LilacFractal/n3_output.png" class="" title="n&#x3D;3 输出">

</details>

<details>
<summary>点击展开/折叠 n=4 的输出图形</summary>

<img src="/2025/10/12/LilacFractal/n4_output.png" class="" title="n&#x3D;4 输出">

</details>

<details>
<summary>点击展开/折叠 n=5 的输出图形</summary>

<img src="/2025/10/12/LilacFractal/n5_output.png" class="" title="n&#x3D;5 输出">

</details>

<details>
<summary>点击展开/折叠 n=6 的输出图形</summary>

<img src="/2025/10/12/LilacFractal/n6_output.png" class="" title="n&#x3D;6 输出">

</details>

<hr>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><ol>
<li><strong>分解操作步骤</strong>：解决本题的第一步，是将题目描述的单次复杂操作，拆解为<strong>奇数步膨胀</strong>和<strong>偶数步重组</strong>这两个逻辑更清晰、更容易实现的交替步骤。</li>
<li><strong>寻找递推规律</strong>：对于复杂的模拟题，直接推导通项公式往往很困难。本题的突破口在于观察并发现了控制图形尺寸和坐标的递推关系（<code>b[i-3]</code>规律），这比纯粹的几何分析要直接得多。</li>
<li><strong>迭代与双缓冲</strong>：采用迭代的方式，一步步从初始状态构建出最终图形，是解决此类问题的稳妥方法。使用 <code>pic</code> 和 <code>temp</code> 两个数组作为双缓冲，可以很方便地根据前一阶段的图形来生成下一阶段，避免了数据的原地修改冲突。</li>
</ol>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2025/10/02/Luogu-P8613-Review/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="nine19een">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="nine19een's Blog">
      <meta itemprop="description" content="记录学习过程中的思考、题解与复盘">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content=" | nine19een's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2025/10/02/Luogu-P8613-Review/" class="post-title-link" itemprop="url">洛谷P8613小朋友排队·复盘——浅谈冒泡排序与逆序对</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2025-10-02 16:05:52" itemprop="dateCreated datePublished" datetime="2025-10-02T16:05:52+08:00">2025-10-02</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2025-10-13 02:21:31" itemprop="dateModified" datetime="2025-10-13T02:21:31+08:00">2025-10-13</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E7%AE%97%E6%B3%95%E9%A2%98%E8%A7%A3-%E5%A4%8D%E7%9B%98/" itemprop="url" rel="index"><span itemprop="name">算法题解/复盘</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>前两天做了一道蓝桥省赛题，是一道对排序思想和实现细节要求较高的题目，由于初次解题时对问题模型的理解存在偏差，导致我的算法方案迭代了两次，耗费了较多时间。本文旨在对整个求解过程进行技术性复盘，深入剖析错误思路的根源，并最终给出一个高效严谨的正确实现。</p>
<hr>
<h2 id="题目分析"><a href="#题目分析" class="headerlink" title="题目分析"></a>题目分析</h2><p><strong><a target="_blank" rel="noopener" href="https://www.luogu.com.cn/problem/P8613">P8613 [蓝桥杯 2014 省 B] 小朋友排队</a></strong></p>
<img src="/2025/10/02/Luogu-P8613-Review/1.png" class="" title="题面">

<p>理解题目后，我们可以提炼出一个核心流程来简化题目：<strong>计算每个小朋友被交换的次数→计算每个小朋友的不高兴程度→求和</strong>。</p>
<p>不难发现，<strong>每次只能交换位置相邻的两个小朋友</strong>实际上就是<strong>冒泡排序</strong>的操作流程。所以问题也就变成了：<strong>对所有小朋友进行冒泡排序，统计出每个小朋友被交换了多少次，并对每个小朋友的不高兴程度进行求和</strong>。</p>
<p>接下来我们需要用到一个小结论：<strong>对一个序列进行冒泡排序时，总交换次数等于该序列逆序对的数量</strong>。结论其实不难理解，对于每一对元素，只有当该对元素为逆序对时，我们才会对其进行交换操作。因此，<strong>总交换次数</strong>一定严格等于<strong>总逆序对数量</strong>。</p>
<p>而在本题中，我们需要的不是<strong>总交换次数</strong>，而是<strong>每个元素被交换的次数</strong>，这也很好实现，仅需统计<strong>包含该元素的逆序对的数量</strong>即可。</p>
<p>至于最终的求和部分，只需要对每个小朋友进行一次<strong>等差数列求和</strong>：<code>f(k) = k * (k+1) / 2</code>，再对所有元素进行求和：<code>Σf(k_i)</code>即可。</p>
<hr>
<h2 id="算法设计及实现"><a href="#算法设计及实现" class="headerlink" title="算法设计及实现"></a><strong>算法设计及实现</strong></h2><p>在明确了<strong>计算每个元素的逆序对总数</strong>这一核心目标后，我选择使用<strong>树状数组+离散化</strong>来解决问题，下文的两次算法设计迭代也都将围绕着树状数组来进行。</p>
<h3 id="V1-0-初试"><a href="#V1-0-初试" class="headerlink" title="V1.0 初试"></a><strong>V1.0 初试</strong></h3><p>最初的方案基于一个宏观的、但忽略了个体差异的思路，它整合了离散化、树状数组和双向遍历三种核心技术，旨在按<strong>身高种类</strong>进行逆序对的统计。</p>
<h4 id="设计"><a href="#设计" class="headerlink" title="设计"></a>设计</h4><ol>
<li><p><strong>核心数据结构：<code>ans_c</code> 数组</strong></p>
<ul>
<li>创建一个大小为 <code>size</code> (唯一身高值的数量) 的数组 <code>ans_c</code>，其中 <code>ans_c[idx]</code> 用于存储<strong>身高排名为 <code>idx</code></strong> 的所有小朋友的逆序对总数（或其累加值）。</li>
</ul>
</li>
<li><p><strong>离散化</strong></p>
<ul>
<li><strong>动机</strong>：<br>题目中身高 <code>H_i</code> 的值域可达 <code>10^6</code>，而 <code>n</code> 最多为 <code>10^5</code>。直接使用身高值作为数组下标是不可行的。</li>
<li><strong>实现</strong>：<br>通过 <strong>排序→去重</strong> 操作，将所有出现过的身高值映射到一个 <code>[1, size]</code> 的紧凑整数区间。一个原始身高值 <code>H</code> 在排序去重后数组 <code>b</code> 中的位置（下标+1），就是它离散化后的新排名 <code>idx</code>。这个 <code>idx</code> 将作为 <code>ans_c</code> 数组和树状数组的下标。</li>
</ul>
</li>
<li><p><strong>树状数组</strong></p>
<ul>
<li><strong>本质</strong>：<br>树状数组是一种高效的数据结构，能够在 <code>O(log n)</code> 的时间内，同时完成 <strong>单点更新</strong> 和 <strong>查询前缀和</strong> 两种操作。</li>
<li><strong>在本方案中的应用</strong>：<br>我利用树状数组来动态回答一个核心问题：“在我当前遍历过的集合中，身高排名在某个范围内的有多少人？”<ul>
<li><code>update(idx, 1)</code>： 当处理一个身高排名为 <code>idx</code> 的小朋友时，执行此操作，意味着“身高排名为<code>idx</code>的人数+1”。</li>
<li><code>query(idx)</code>： 执行此操作，可以得到“身高排名在 <code>[1, idx]</code> 区间内的人数总和”。</li>
</ul>
</li>
</ul>
</li>
<li><p><strong>双向遍历策略</strong></p>
<ul>
<li><strong>依据</strong>：<br>一个元素的总逆序对数 <code>k</code>，等于其<strong>左侧</strong>大于它的元素数，加上其<strong>右侧</strong>小于它的元素数。这两个部分需要分开计算。</li>
</ul>
</li>
</ol>
<p><strong>算法执行流程</strong></p>
<ul>
<li><strong>a. 正向遍历 (计算左逆序对):</strong><ul>
<li>从左到右遍历原始身高数组 <code>a</code>。</li>
<li>对于每个身高 <code>p</code>，首先查询树状数组 <code>c</code>，计算在 <code>p</code> 左侧、且值大于 <code>p</code> 的元素数量。</li>
<li>将此数量<strong>赋值</strong>给 <code>ans_c[idx]</code>，其中 <code>idx</code> 是 <code>p</code> 的身高排名。</li>
<li>在树状数组中执行 <code>update(idx, 1)</code>，将当前元素 <code>p</code> 加入“已处理”集合。</li>
</ul>
</li>
<li><strong>b. 反向遍历 (计算右逆序对):</strong><ul>
<li>清空树状数组 <code>c</code>。</li>
<li>从右到左遍历原始身高数组 <code>a</code>。</li>
<li>对于每个身高 <code>p</code>，查询树状数组 <code>c</code>，计算在 <code>p</code> 右侧、且值小于 <code>p</code> 的元素数量。</li>
<li>将此数量<strong>累加</strong>到 <code>ans_c[idx]</code> 上。</li>
<li>在树状数组中执行 <code>update(idx, 1)</code>。</li>
</ul>
</li>
<li><strong>c. 计算总和:</strong><ul>
<li>遍历 <code>ans_c</code> 数组，对每个 <code>k = ans_c[idx]</code>，计算 <code>sum(k)</code> 并求和，得到最终答案。</li>
</ul>
</li>
</ul>
<h4 id="可行性分析"><a href="#可行性分析" class="headerlink" title="可行性分析"></a><strong>可行性分析</strong></h4><p>在编码前，对该方案的复杂度进行预估：</p>
<ul>
<li><p><strong>时间复杂度:</strong></p>
<ol>
<li><strong>离散化</strong>: 核心操作是 <code>std::sort</code>，复杂度为 <code>O(n log n)</code>。</li>
<li><strong>双向遍历</strong>: 包含两次独立的、遍历 <code>n</code> 个元素的循环。在每次循环内部，<code>lower_bound</code> 操作的复杂度为 <code>O(log size)</code>，树状数组的 <code>query</code> 和 <code>update</code> 操作复杂度均为 <code>O(log size)</code>。因此，这两次遍历的总时间复杂度为 <code>O(n log size)</code>。</li>
<li><strong>最终求和</strong>: <code>O(n)</code> 或 <code>O(size)</code>。</li>
</ol>
<ul>
<li>由于 <code>size &lt;= n</code>，因此<strong>总时间复杂度为 <code>O(n log n)</code></strong>。对于 <code>n = 10^5</code> 的数据规模，<code>10^5 * log(10^5)</code> 约等于 <code>1.7 * 10^6</code>，远在 <code>10^8</code> 的安全线内，<strong>不会TLE</strong>。</li>
</ul>
</li>
<li><p><strong>空间复杂度:</strong></p>
<ol>
<li><code>a</code>, <code>b</code> 两个 <code>vector</code> 占用 <code>O(n)</code> 空间。</li>
<li>树状数组 <code>cnt_c</code> 和结果数组 <code>ans_c</code> 均占用 <code>O(size)</code> 空间，最坏情况下 <code>size = n</code>，即 <code>O(n)</code>。</li>
</ol>
<ul>
<li><strong>总空间复杂度为 <code>O(n)</code></strong>，对于 <code>n = 10^5</code>，内存占用<strong>在可接受范围内</strong>。</li>
</ul>
</li>
<li><p><strong>结论：</strong><br>从时间&#x2F;空间复杂度的角度分析，<strong>方案可行</strong>。</p>
</li>
</ul>
<h4 id="实现"><a href="#实现" class="headerlink" title="实现"></a><strong>实现</strong></h4><p>基于以上思路，我构建了第一版代码。其核心是创建了一个大小为 <code>size</code> 的数组 <code>ans_c</code>，其中 <code>ans_c[idx]</code> 旨在存储身高排名为 <code>idx</code> 的小朋友的总逆序对数。此时我并没有注意到，我的算法设计存在一个严重的漏洞，这也让我的初次提交仅拿到了一个测试点的分数。</p>
<img src="/2025/10/02/Luogu-P8613-Review/2.png" class="" title="10分提交记录">

<p><a target="_blank" rel="noopener" href="https://www.luogu.com.cn/record/237572595">初次提交记录</a></p>
<details>
<summary>点击展开/折叠 初版代码</summary>

<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="keyword">using</span> ll = <span class="type">long</span> <span class="type">long</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="type">const</span> maxn = <span class="number">1e5</span> + <span class="number">5</span>;</span><br><span class="line"><span class="type">int</span> n;</span><br><span class="line"></span><br><span class="line">vector&lt;<span class="type">int</span>&gt; a, b;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">lowbit</span><span class="params">(<span class="type">int</span> x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x &amp; -x;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">ll <span class="title">query</span><span class="params">(<span class="type">int</span> x, ll arr[])</span> </span>&#123;</span><br><span class="line">    ll ans_q = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = x; i != <span class="number">0</span>; i -= <span class="built_in">lowbit</span>(i)) &#123;</span><br><span class="line">        ans_q += arr[i];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ans_q;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">update</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> add, <span class="type">int</span> size, ll arr[])</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = x; i &lt;= size; i += <span class="built_in">lowbit</span>(i)) &#123;</span><br><span class="line">        arr[i] += add;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">ll <span class="title">sum</span><span class="params">(ll x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> (<span class="number">1</span> + x) * x / <span class="number">2</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    ios_base::<span class="built_in">sync_with_stdio</span>(<span class="literal">false</span>);</span><br><span class="line">    cin.<span class="built_in">tie</span>(<span class="literal">NULL</span>);</span><br><span class="line">    a.<span class="built_in">reserve</span>(maxn);</span><br><span class="line">    b.<span class="built_in">reserve</span>(maxn);</span><br><span class="line">    cin &gt;&gt; n;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">        <span class="type">int</span> num;</span><br><span class="line">        cin &gt;&gt; num;</span><br><span class="line">        a.<span class="built_in">push_back</span>(num);</span><br><span class="line">        b.<span class="built_in">push_back</span>(num);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">sort</span>(b.<span class="built_in">begin</span>(), b.<span class="built_in">end</span>());</span><br><span class="line">    b.<span class="built_in">erase</span>(<span class="built_in">unique</span>(b.<span class="built_in">begin</span>(), b.<span class="built_in">end</span>()), b.<span class="built_in">end</span>());</span><br><span class="line">    <span class="type">int</span> size = b.<span class="built_in">size</span>();</span><br><span class="line">    ll cnt_c[size + <span class="number">5</span>] = &#123;<span class="number">0</span>&#125;, ans_c[size + <span class="number">5</span>] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line">    <span class="type">int</span> cnt = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> p : a) &#123;</span><br><span class="line">        cnt++;</span><br><span class="line">        <span class="type">int</span> idx = <span class="built_in">lower_bound</span>(b.<span class="built_in">begin</span>(), b.<span class="built_in">end</span>(), p) - b.<span class="built_in">begin</span>() + <span class="number">1</span>;</span><br><span class="line">        <span class="built_in">update</span>(idx, <span class="number">1</span>, size, cnt_c);</span><br><span class="line">        ans_c[idx] = cnt - <span class="built_in">query</span>(idx, cnt_c);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">memset</span>(cnt_c, <span class="number">0</span>, <span class="built_in">sizeof</span>(cnt_c));</span><br><span class="line">    cnt = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span> it = a.<span class="built_in">rbegin</span>(); it != a.<span class="built_in">rend</span>(); ++it) &#123;</span><br><span class="line">        <span class="type">int</span> idx = <span class="built_in">lower_bound</span>(b.<span class="built_in">begin</span>(), b.<span class="built_in">end</span>(), *it) - b.<span class="built_in">begin</span>() + <span class="number">1</span>;</span><br><span class="line">        ans_c[idx] += <span class="built_in">query</span>(idx, cnt_c);</span><br><span class="line">        <span class="built_in">update</span>(idx, <span class="number">1</span>, size, cnt_c);</span><br><span class="line">    &#125;</span><br><span class="line">    ll ans = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i++) &#123;</span><br><span class="line">        ans += <span class="built_in">sum</span>(ans_c[i]);</span><br><span class="line">    &#125;</span><br><span class="line">    cout &lt;&lt; ans &lt;&lt; endl;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</details>

<h4 id="错误分析"><a href="#错误分析" class="headerlink" title="错误分析"></a><strong>错误分析</strong></h4><p>该方案在提交后仅获得 10 分，原因在于其数据结构的设计与问题要求不匹配，存在严重的逻辑缺陷。</p>
<ul>
<li><p><strong>问题根源：</strong><br>当序列中存在多个身高相同的元素时，它们在离散化后会映射到<strong>同一个排名 <code>idx</code></strong>。这导致 <code>ans_c[idx]</code> 在计算过程中，会<strong>错误地覆盖或累加</strong>属于不同原始位置元素的数据。</p>
<p>例如，对于序列 <code>[H1, H2, H1]</code>，第二个 <code>H1</code> 的计算结果会直接覆盖第一个 <code>H1</code> 的，造成信息丢失。</p>
</li>
<li><p><strong>结论：</strong><br>算法的数据统计粒度必须精确到<strong>每个独立的个体<code>n</code></strong>，而非<strong>每种属性的类别<code>size</code></strong>。</p>
</li>
</ul>
<h3 id="V2-0-改进（AC方案）"><a href="#V2-0-改进（AC方案）" class="headerlink" title="V2.0 改进（AC方案）"></a><strong>V2.0 改进（AC方案）</strong></h3><p>为修正上述缺陷，必须调整数据结构，为每个原始元素建立独立的档案。</p>
<h4 id="设计-1"><a href="#设计-1" class="headerlink" title="设计"></a><strong>设计</strong></h4><ol>
<li>创建一个大小为 <code>n</code> 的数组 <code>ans_a</code>，其中 <code>ans_a[i]</code> 用于存储<strong>原始序列中第 <code>i</code> 个元素</strong>的总交换次数。</li>
<li><strong>正向遍历 (计算左逆序对):</strong><ul>
<li><code>for i from 0 to n-1</code>:</li>
<li>利用树状数组 <code>c</code> 查询在 <code>[0, i-1]</code> 区间内，值大于 <code>a[i]</code> 的元素数量。</li>
<li>结果累加至 <code>ans_a[i]</code>。</li>
<li>将 <code>a[i]</code> 的信息更新到树状数组 <code>c</code> 中。</li>
</ul>
</li>
<li><strong>反向遍历 (计算右逆序对):</strong><ul>
<li>清空树状数组 <code>c</code>。</li>
<li><code>for i from n-1 down to 0</code>:</li>
<li>利用树状数组 <code>c</code> 查询在 <code>[i+1, n-1]</code> 区间内，值小于 <code>a[i]</code> 的元素数量。</li>
<li>结果累加至 <code>ans_a[i]</code>。</li>
<li>将 <code>a[i]</code> 的信息更新到树状数组 <code>c</code> 中。</li>
</ul>
</li>
<li><strong>计算总和:</strong><ul>
<li>遍历 <code>ans_a</code> 数组，对每个 <code>k_i = ans_a[i]</code>，计算 <code>sum(k_i)</code> 并累加，得到最终答案。</li>
</ul>
</li>
</ol>
<h4 id="可行性分析-1"><a href="#可行性分析-1" class="headerlink" title="可行性分析"></a><strong>可行性分析</strong></h4><ul>
<li><p><strong>时间复杂度:</strong></p>
<ul>
<li>该方案的核心计算流程与 V1.0 完全一致，依然是“离散化 + 两次 <code>n</code> 循环内嵌 <code>log size</code> 操作”。因此，<strong>总时间复杂度仍然是 <code>O(n log n)</code></strong>，性能上依然高效。</li>
</ul>
</li>
<li><p><strong>空间复杂度:</strong></p>
<ul>
<li>与 V1.0 的唯一区别在于结果数组。<code>ans_a</code> 的大小为 <code>n</code>，替代了 V1.0 中大小为 <code>size</code> 的 <code>ans_c</code>。在最坏情况下 <code>size=n</code>，两者空间占用相当。</li>
<li><strong>总空间复杂度依然为 <code>O(n)</code></strong>。</li>
</ul>
</li>
<li><p><strong>结论：</strong><br>从时间&#x2F;空间复杂度的角度分析，<strong>方案可行</strong>。</p>
</li>
</ul>
<h4 id="实现-1"><a href="#实现-1" class="headerlink" title="实现"></a><strong>实现</strong></h4><p>该方案通过以<strong>数组下标 <code>i</code> 关联原始位置</strong>，确保了数据归属的唯一性，且代码实现比 <strong>V1.0</strong> 更简洁。</p>
<img src="/2025/10/02/Luogu-P8613-Review/3.png" class="" title="AC提交记录">

<p><a target="_blank" rel="noopener" href="https://www.luogu.com.cn/record/237593958">最终AC提交记录</a></p>
<details>
<summary>点击展开/折叠 最终AC代码</summary>

<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="keyword">using</span> ll = <span class="type">long</span> <span class="type">long</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="type">const</span> maxn = <span class="number">1e5</span> + <span class="number">5</span>;</span><br><span class="line"><span class="type">int</span> n;</span><br><span class="line"></span><br><span class="line">vector&lt;<span class="type">int</span>&gt; a, b;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">lowbit</span><span class="params">(<span class="type">int</span> x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x &amp; -x;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">ll <span class="title">query</span><span class="params">(<span class="type">int</span> x, ll arr[])</span> </span>&#123;</span><br><span class="line">    ll ans_q = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = x; i != <span class="number">0</span>; i -= <span class="built_in">lowbit</span>(i)) &#123;</span><br><span class="line">        ans_q += arr[i];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ans_q;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">update</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> add, <span class="type">int</span> size, ll arr[])</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = x; i &lt;= size; i += <span class="built_in">lowbit</span>(i)) &#123;</span><br><span class="line">        arr[i] += add;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">ll <span class="title">sum</span><span class="params">(ll x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> (<span class="number">1</span> + x) * x / <span class="number">2</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    ios_base::<span class="built_in">sync_with_stdio</span>(<span class="literal">false</span>);</span><br><span class="line">    cin.<span class="built_in">tie</span>(<span class="literal">NULL</span>);</span><br><span class="line">    a.<span class="built_in">reserve</span>(maxn);</span><br><span class="line">    b.<span class="built_in">reserve</span>(maxn);</span><br><span class="line">    cin &gt;&gt; n;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">        <span class="type">int</span> num;</span><br><span class="line">        cin &gt;&gt; num;</span><br><span class="line">        a.<span class="built_in">push_back</span>(num);</span><br><span class="line">        b.<span class="built_in">push_back</span>(num);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">sort</span>(b.<span class="built_in">begin</span>(), b.<span class="built_in">end</span>());</span><br><span class="line">    b.<span class="built_in">erase</span>(<span class="built_in">unique</span>(b.<span class="built_in">begin</span>(), b.<span class="built_in">end</span>()), b.<span class="built_in">end</span>());</span><br><span class="line">    <span class="type">int</span> size = b.<span class="built_in">size</span>();</span><br><span class="line">    ll cnt_c[size + <span class="number">5</span>] = &#123;<span class="number">0</span>&#125;, ans_a[n + <span class="number">5</span>] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">        <span class="type">int</span> idx = <span class="built_in">lower_bound</span>(b.<span class="built_in">begin</span>(), b.<span class="built_in">end</span>(), a[i]) - b.<span class="built_in">begin</span>() + <span class="number">1</span>;</span><br><span class="line">        <span class="built_in">update</span>(idx, <span class="number">1</span>, size, cnt_c);</span><br><span class="line">        ans_a[i] += i + <span class="number">1</span> - <span class="built_in">query</span>(idx, cnt_c);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">memset</span>(cnt_c, <span class="number">0</span>, <span class="built_in">sizeof</span>(cnt_c));</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = n - <span class="number">1</span>; i &gt;= <span class="number">0</span>; i--) &#123;</span><br><span class="line">        <span class="type">int</span> idx = <span class="built_in">lower_bound</span>(b.<span class="built_in">begin</span>(), b.<span class="built_in">end</span>(), a[i]) - b.<span class="built_in">begin</span>() + <span class="number">1</span>;</span><br><span class="line">        ans_a[i] += <span class="built_in">query</span>(idx - <span class="number">1</span>, cnt_c);</span><br><span class="line">        <span class="built_in">update</span>(idx, <span class="number">1</span>, size, cnt_c);</span><br><span class="line">    &#125;</span><br><span class="line">    ll ans = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">        ans += <span class="built_in">sum</span>(ans_a[i]);</span><br><span class="line">    &#125;</span><br><span class="line">    cout &lt;&lt; ans &lt;&lt; endl;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</details>

<ul>
<li><p><strong>实现细节注意：正向与反向遍历的逻辑对称性</strong></p>
<p>我代码中的两次遍历，在 <code>update</code> 和 <code>query</code> 的顺序与逻辑上，展现了一种精妙的对称性，值得在此详细剖析。</p>
<ol>
<li><p><strong>正向遍历 (计算左逆序对): “先改后查”</strong></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">    <span class="type">int</span> idx = <span class="built_in">lower_bound</span>(b.<span class="built_in">begin</span>(), b.<span class="built_in">end</span>(), a[i]) - b.<span class="built_in">begin</span>() + <span class="number">1</span>;</span><br><span class="line">    <span class="built_in">update</span>(idx, <span class="number">1</span>, size, cnt_c);</span><br><span class="line">    ans_a[i] += i + <span class="number">1</span> - <span class="built_in">query</span>(idx, cnt_c);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li><strong>执行顺序</strong>:<br>先将当前元素 <code>a[i]</code> 加入树状数组 (<code>update</code>)，再进行查询 (<code>query</code>)。</li>
<li><strong>逻辑解读</strong>:<br><code>query(idx, cnt_c)</code> 查询的是<strong>包含 <code>a[i]</code> 自身在内</strong>的、<code>[0, i]</code> 区间中值小于等于 <code>a[i]</code> 的元素数量。因此，用已处理的总数 <code>i + 1</code> 减去它，就得到了 <code>[0, i]</code> 区间内值大于 <code>a[i]</code> 的数量。由于元素不可能大于自身，该结果精确等价于 <code>a[i]</code> 的左逆序对数。</li>
</ul>
</li>
<li><p><strong>反向遍历 (计算右逆序对): “先查后改”</strong></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = n - <span class="number">1</span>; i &gt;= <span class="number">0</span>; i--) &#123;</span><br><span class="line">    <span class="type">int</span> idx = <span class="built_in">lower_bound</span>(b.<span class="built_in">begin</span>(), b.<span class="built_in">end</span>(), a[i]) - b.<span class="built_in">begin</span>() + <span class="number">1</span>;</span><br><span class="line">    ans_a[i] += <span class="built_in">query</span>(idx - <span class="number">1</span>, cnt_c);</span><br><span class="line">    <span class="built_in">update</span>(idx, <span class="number">1</span>, size, cnt_c);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li><strong>执行顺序</strong>:<br>先进行查询 (<code>query</code>)，再将当前元素 <code>a[i]</code> 加入树状数组 (<code>update</code>)。</li>
<li><strong>逻辑解读</strong>:<br><code>query(idx - 1, cnt_c)</code> 查询的是<strong>在 <code>a[i]</code> 被加入之前</strong>，树状数组中已有的（即 <code>[i+1, n-1]</code> 区间内的）元素里，排名严格小于 <code>idx</code>（即值严格小于 <code>a[i]</code>）的数量。这直接就是 <code>a[i]</code> 的右逆序对数。</li>
</ul>
</li>
</ol>
<p><strong>对比总结：</strong><br>正向遍历采用“先改后查”的策略，通过总数减法巧妙地排除了自身的影响；而反向遍历则采用“先查后改”的策略，直接查询所需的结果。两者虽然实现顺序相反，但都最终达成了正确的计算目的，体现了算法实现的灵活性。</p>
</li>
</ul>
<hr>
<p><strong>P.S.</strong> 最后附上我做题时的杂乱草稿（</p>
<img src="/2025/10/02/Luogu-P8613-Review/4.jpg" class="" title="做题草稿">

<hr>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><ol>
<li><strong>问题转化的重要性</strong>：本题的核心在于将一个复杂的、带非线性成本的排序问题，成功转化为一个纯粹的、可分步计算的<strong>为序列中每个元素统计逆序对</strong>的组合计数问题。</li>
<li><strong>实现与模型的匹配</strong>：数据结构的选择与实现，必须在<strong>个体粒度</strong>上与问题模型保持一致。这是避免在存在重复元素时出现逻辑错误的关键。</li>
<li><strong>工具的正确使用</strong>：树状数组作为一种高效的动态前缀和工具，非常适合在本题的正、反向遍历中，进行动态的范围计数。</li>
</ol>
<p>希望本次复盘能为解决类似问题提供一个清晰的思路。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2025/09/22/%E4%BB%8E4%E5%B0%8F%E6%97%B6%E5%88%B02%E5%88%86%E9%92%9F%EF%BC%9A%E6%88%91%E7%9A%84GitHub-Profile%E8%87%AA%E5%8A%A8%E5%8C%96%E6%9E%84%E5%BB%BA%E4%B9%8B%E8%B7%AF/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="nine19een">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="nine19een's Blog">
      <meta itemprop="description" content="记录学习过程中的思考、题解与复盘">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content=" | nine19een's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2025/09/22/%E4%BB%8E4%E5%B0%8F%E6%97%B6%E5%88%B02%E5%88%86%E9%92%9F%EF%BC%9A%E6%88%91%E7%9A%84GitHub-Profile%E8%87%AA%E5%8A%A8%E5%8C%96%E6%9E%84%E5%BB%BA%E4%B9%8B%E8%B7%AF/" class="post-title-link" itemprop="url">从 4 小时到 2 分钟：我的 GitHub Profile 自动化构建与持续集成之路</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2025-09-22 18:30:00 / 修改时间：19:41:45" itemprop="dateCreated datePublished" datetime="2025-09-22T18:30:00+08:00">2025-09-22</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%8A%80%E6%9C%AF%E5%AE%9E%E8%B7%B5/" itemprop="url" rel="index"><span itemprop="name">技术实践</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>高考结束后的那个夏天，我没有选择狂欢，而是一头扎进了代码的世界。当两个月的算法与数据结构探索之旅告一段落，我决心将这段经历记录下来，让努力留下可视化的痕迹。为了实现这个目标，我将目光投向了 GitHub ，我计划用 GitHub 为自己打造一个独一无二的、能够动态展示我的学习历程的个人主页。</p>
<p>我了解到，常规的 <code>git push</code> 会将所有提交的时间戳记为当前时刻，导致 GitHub 贡献图无法真实反映、精确还原我暑假期间的学习轨迹。</p>
<p>为了解决这一问题，并为未来的学习过程建立一个可追溯、可视化的档案，我设计并实施了本次手动迁移与版本历史构建的任务。</p>
<p>这篇文章，将详细记录我从连 Git 指令都敲不对，到最终利用 Python 脚本实现自动化操作的完整过程以及心路历程。</p>
<hr>
<h2 id="手动实现：基础工作流与问题排查"><a href="#手动实现：基础工作流与问题排查" class="headerlink" title="手动实现：基础工作流与问题排查"></a>手动实现：基础工作流与问题排查</h2><p>我决定采用 <code>git commit</code> 命令，为每一份题解代码创建带有历史时间戳的提交。这个方案虽然可行，但在手动执行的过程中，我遇到并解决了一系列典型的命令行与 Git 环境配置问题。下面将对这些问题进行复盘。</p>
<h3 id="核心实现思路"><a href="#核心实现思路" class="headerlink" title="核心实现思路"></a>核心实现思路</h3><p>本次操作的技术基石是 Git 的 <code>commit</code> 命令所提供的 <code>--date</code> 参数。该参数允许用户在创建提交时，指定一个自定义的时间戳，从而实现对版本历史的回溯性构建。</p>
<p>我设计的基础工作流的操作流程如下：</p>
<ol>
<li><p>将代码文件添加至工作区。</p>
</li>
<li><p>在代码文件的前四行手动添加格式规范的注释，格式如下：</p>
<p> <code>// Problem:  练习平台 题号 题目</code><br> <code>// Link:     题目链接</code><br> <code>// Author:   nine19een</code><br> <code>// Date:     日期</code><br> <code>//</code><br> <code>// 代码正文</code></p>
</li>
<li><p>使用 <code>git add</code> 将文件变更添加至暂存区。</p>
</li>
<li><p>执行带有特定历史日期的 <code>git commit</code> 命令以创建提交。</p>
</li>
</ol>
<p>核心命令示例：</p>
<p><strong><code>git commit --date=&quot;YYYY-MM-DD HH:MM:SS&quot; -m &quot;Creat 文件名&quot;</code></strong></p>
<p>其中，<code>--date</code> 参数用于指定历史时间戳，可通过练习平台的提交记录获取并手动替换进指令里。</p>
<h3 id="环境配置与故障排查"><a href="#环境配置与故障排查" class="headerlink" title="环境配置与故障排查"></a>环境配置与故障排查</h3><p>在将上述流程的实践过程中，我遇到并解决了以下几个典型的环境配置与命令行操作问题。</p>
<h4 id="Case-1-路径导航错误-No-such-file-or-directory"><a href="#Case-1-路径导航错误-No-such-file-or-directory" class="headerlink" title="Case 1: 路径导航错误 - No such file or directory"></a><strong>Case 1: 路径导航错误 - <code>No such file or directory</code></strong></h4><ul>
<li><p><strong>现象:</strong><br>在 Git Bash 环境下，使用 <code>cd</code> 命令并提供 Windows 文件管理器中的标准路径，无法成功切换目录，返回 <code>No such file or directory</code> 错误。</p>
</li>
<li><p><strong>问题分析:</strong><br>该错误源于 Windows 与类 Unix 环境 (Git Bash) 在路径表示法上的差异。主要有两点：</p>
<ol>
<li><strong>路径分隔符:</strong> Windows 使用 <code>\</code>，而 Git Bash 需要 <code>/</code>，因此，<strong>直接在Windows的文件资源管理器中复制路径并粘贴到 Git Bash 窗口是不可行的！</strong></li>
<li><strong>路径完整性:</strong> 必须提供从盘符开始的完整、正确的路径结构。</li>
</ol>
</li>
<li><p><strong>解决方案:</strong></p>
<ol>
<li><p><strong>格式修正:</strong> 若选择<strong>路径复制&#x2F;粘贴</strong>方案，需手动将路径中的 <code>\</code> 全部替换为 <code>/</code>，并确保路径完整（如 <code>C:/Users/YourName/Documents/...</code>）。</p>
</li>
<li><p><strong>GUI 辅助:</strong> 作为一种更高效且不易出错的方法，可以在 <code>cd </code> 命令后，直接将目标文件夹从文件管理器拖拽至 Git Bash 窗口，以自动生成符合其语法规范的完整路径。<strong>强烈建议使用该方法，不易出错</strong>。</p>
<img src="/2025/09/22/%E4%BB%8E4%E5%B0%8F%E6%97%B6%E5%88%B02%E5%88%86%E9%92%9F%EF%BC%9A%E6%88%91%E7%9A%84GitHub-Profile%E8%87%AA%E5%8A%A8%E5%8C%96%E6%9E%84%E5%BB%BA%E4%B9%8B%E8%B7%AF/1.jpg" class="" title="拖拽操作示例">

<p>将文件拖拽进 Git Bash 窗口即会自动生成完整路径。</p>
<img src="/2025/09/22/%E4%BB%8E4%E5%B0%8F%E6%97%B6%E5%88%B02%E5%88%86%E9%92%9F%EF%BC%9A%E6%88%91%E7%9A%84GitHub-Profile%E8%87%AA%E5%8A%A8%E5%8C%96%E6%9E%84%E5%BB%BA%E4%B9%8B%E8%B7%AF/2.jpg" class="" title="拖拽操作结果">

<p>再按回车即可。</p>
</li>
</ol>
</li>
</ul>
<h4 id="Case-2-仓库定位错误-fatal-not-a-git-repository"><a href="#Case-2-仓库定位错误-fatal-not-a-git-repository" class="headerlink" title="Case 2: 仓库定位错误 - fatal: not a git repository"></a><strong>Case 2: 仓库定位错误 - <code>fatal: not a git repository</code></strong></h4><ul>
<li><p><strong>现象:</strong><br>在 <code>git clone</code> 操作成功后，在当前目录（即 <code>clone</code> 命令的执行目录）下运行 <code>git status</code> 或 <code>git add</code> 等命令，系统返回致命错误，提示当前目录并非一个 Git 仓库。</p>
</li>
<li><p><strong>问题分析:</strong><br><code>git clone</code> 命令会在当前目录下创建一个<strong>新的子目录</strong>作为仓库的根目录。所有 Git 相关的操作，都必须在这个新生成的子目录（或其内部）执行，因为根目录中包含了必需的 <code>.git</code> 元数据文件夹。错误发生时，我正处在仓库的父目录。</p>
</li>
<li><p><strong>解决方案:</strong><br>执行 <code>git clone</code> 后，必须使用 <code>cd &lt;repository-name&gt;</code> 命令，<strong>进入到新克隆的仓库根目录</strong>，再执行后续的 Git 操作。</p>
</li>
</ul>
<h4 id="Case-3-网络连接失败-schannel-failed-to-receive-handshake-SSL-TLS-connection-failed"><a href="#Case-3-网络连接失败-schannel-failed-to-receive-handshake-SSL-TLS-connection-failed" class="headerlink" title="Case 3: 网络连接失败 - schannel: failed to receive handshake, SSL/TLS connection failed"></a><strong>Case 3: 网络连接失败 - <code>schannel: failed to receive handshake, SSL/TLS connection failed</code></strong></h4><ul>
<li><p><strong>现象:</strong><br>在解决了本地的路径和仓库定位问题后，我遇到了最棘手的一个 blocker。当执行 <code>git push</code>, <code>git pull</code>, <code>git fetch</code> 等任何需要与远程服务器通信的网络操作时，命令会在长时间等待后失败，并返回一个底层网络错误：<code>schannel: failed to receive handshake, SSL/TLS connection failed</code>。</p>
<p>最令人困惑的是，与此同时，我的浏览器却可以正常、快速地访问 <code>github.com</code> 网站。</p>
</li>
<li><p><strong>问题分析:</strong><br>这个现象——“浏览器可以，但命令行不行”——是一个非常典型的<strong>网络代理配置问题</strong>。</p>
<p>问题根源在于，我的电脑上运行了 Clash 这样的网络代理工具来优化网络访问。浏览器被正确配置为通过代理来访问 GitHub，所以连接顺畅。然而，Git Bash 作为一个独立的命令行环境，<strong>默认不会</strong>自动使用系统的代理设置。</p>
<p>因此，Git 仍在尝试<strong>直接连接</strong> GitHub 的服务器，这条直连路径受到了网络环境的干扰，导致在 SSL&#x2F;TLS 加密握手阶段就因超时而失败。<code>schannel</code> 是 Windows 系统用于处理此过程的内置安全库的名称。</p>
</li>
<li><p><strong>解决方案:</strong><br>解决方案的核心是：<strong>必须为 Git 命令行工具，手动配置与系统代理一致的代理服务器。</strong></p>
<p>这个过程分为两步：</p>
<ol>
<li><p><strong>定位代理端口号：</strong><br>首先，需要找到 Clash 代理软件为 HTTP&#x2F;HTTPS 协议监听的本地端口号。这里我以我使用的 Clash Verge 进行举例。</p>
<img src="/2025/09/22/%E4%BB%8E4%E5%B0%8F%E6%97%B6%E5%88%B02%E5%88%86%E9%92%9F%EF%BC%9A%E6%88%91%E7%9A%84GitHub-Profile%E8%87%AA%E5%8A%A8%E5%8C%96%E6%9E%84%E5%BB%BA%E4%B9%8B%E8%B7%AF/3.jpg" class="" title="寻找端口号">
</li>
<li><p><strong>为 Git 配置全局代理：</strong><br>接着，需要在 Git Bash 内执行以下两条命令，将 Git 的 <code>http.proxy</code> 和 <code>https.proxy</code> 都指向本地代理的监听地址 (<code>http://127.0.0.1:端口号</code>)。P.S. <code>127.0.0.1</code> 是一个永远指向本机的特殊 IP 地址。</p>
<ul>
<li><p>将 Git 的 HTTP 流量指向本地端口：</p>
<p><strong><code>git config --global http.proxy http://127.0.0.1:端口号</code></strong></p>
</li>
<li><p>将 Git 的 HTTPS 流量也指向本地端口 (关键)：</p>
<p><strong><code>git config --global https.proxy http://127.0.0.1:端口号</code></strong></p>
</li>
</ul>
</li>
</ol>
</li>
</ul>
<p>在执行完这两条命令，成功地为 Git “开启代理”之后，再次运行 <code>git fetch</code>，网络连接问题迎刃而解。</p>
<h4 id="Case-4-推送被拒绝-rejected-main-main-fetch-first"><a href="#Case-4-推送被拒绝-rejected-main-main-fetch-first" class="headerlink" title="Case 4: 推送被拒绝 - ! [rejected] main -&gt; main (fetch first)"></a><strong>Case 4: 推送被拒绝 - <code>! [rejected] main -&gt; main (fetch first)</code></strong></h4><ul>
<li><p><strong>现象:</strong><br>在本地进行 <code>commit</code> 操作后，执行 <code>git push</code> 时，推送被远程服务器拒绝。提示信息指出，远程仓库包含了本地所没有的修改。</p>
</li>
<li><p><strong>问题分析:</strong><br>这是 Git 的一种保护机制，旨在防止本地的推送<strong>意外覆盖</strong>掉远程仓库上其他人（或自己在别处）的提交。这种情况通常发生于：在本地 <code>clone</code> 或上次 <code>pull</code> 之后，远程仓库又有了新的 <code>commit</code>（例如，<strong>直接在 GitHub 网站上修改了 <code>README.md</code> 文件</strong>）。</p>
</li>
<li><p><strong>解决方案:</strong><br><strong>请务必在每次</strong> <code>git push</code> <strong>之前先执行</strong> <code>git pull</code> ，以确保本地和远程仓库的文件更新保持同步。</p>
<ol>
<li>执行 <code>git pull</code> 命令，将远程的最新变更下载到本地并自动合并。</li>
<li>在解决了可能出现的合并冲突（对于个人项目，通常会自动合并成功）后，再次执行 <code>git push</code>。</li>
</ol>
</li>
</ul>
<h4 id="Case-5-换行符警告-LF-will-be-replaced-by-CRLF"><a href="#Case-5-换行符警告-LF-will-be-replaced-by-CRLF" class="headerlink" title="Case 5: 换行符警告 - LF will be replaced by CRLF"></a><strong>Case 5: 换行符警告 - <code>LF will be replaced by CRLF</code></strong></h4><ul>
<li><p><strong>现象:</strong><br>在 <code>git add</code> 一个文件时，Git bash 会出现一条警告，提示文件中的 <code>LF</code> 将会被 <code>CRLF</code> 替换。</p>
</li>
<li><p><strong>问题分析:</strong><br>这是由于不同操作系统使用的换行符标准不同导致的。Unix&#x2F;Linux&#x2F;macOS 使用 <code>LF</code> ，而 Windows 使用 <code>CRLF</code> 。Git 内置了 <code>core.autocrlf</code> 功能，能够自动在不同系统间转换换行符，以保证版本库中的换行符格式统一。这个警告正是该功能在工作的体现。</p>
</li>
<li><p><strong>解决方案:</strong><br><strong>无视风险，继续访问</strong>（）。无需任何操作，可以安全地忽略此警告。因为这是 Git 的正常行为，代表它正在后台为我们处理跨平台兼容性问题。</p>
</li>
</ul>
<h4 id="Case-6-暂存区管理-在误操作后如何撤销-git-add"><a href="#Case-6-暂存区管理-在误操作后如何撤销-git-add" class="headerlink" title="Case 6: 暂存区管理 - 在误操作后如何撤销 git add"></a><strong>Case 6: 暂存区管理 - 在误操作后如何撤销 <code>git add</code></strong></h4><ul>
<li><p><strong>现象:</strong><br>在执行 <code>git add .</code> 后，发现将一些不需要的文件（或错误的修改）添加到了暂存区，需要在 <code>commit</code> 前进行撤销。</p>
</li>
<li><p><strong>问题分析:</strong><br>这是 Git 工作流中非常常见的需求。需要一个命令，能将文件从暂存区安全地移回工作区，而不丢失任何代码修改。</p>
</li>
<li><p><strong>解决方案:</strong></p>
<ol>
<li><p><strong>撤销所有暂存：</strong> 使用 <code>git reset</code> 命令，可以一次性清空整个暂存区。</p>
<p><strong><code>git reset</code></strong></p>
</li>
<li><p><strong>撤销单个文件：</strong> 使用 <code>git restore --staged &lt;file&gt;</code> 命令，可以精确地将指定文件移出暂存区。</p>
<p><strong><code>git restore --staged &lt;filename&gt;</code></strong></p>
</li>
</ol>
<p>这两种方式都<strong>不会修改工作区的文件内容</strong>，非常安全。</p>
</li>
</ul>
<hr>
<h2 id="自动化实现：从“体力劳动”到“系统构建”"><a href="#自动化实现：从“体力劳动”到“系统构建”" class="headerlink" title="自动化实现：从“体力劳动”到“系统构建”"></a>自动化实现：从“体力劳动”到“系统构建”</h2><p><strong>历时四个小时</strong>的手动历史提交迁移结束后，我立刻意识到：为这上百份题解代码，手动在 <code>README.md</code> 中创建并维护一个格式统一、内容准确、且按日期排序的表格，<del>不仅极度耗时，且极易出错。</del><strong>我会死掉的</strong>。</p>
<p>因此，我决定采用 Python 编写自动化脚本，将整个 <code>README.md</code> 的更新流程自动化。P.S.<del>懒惰是人类的第一生产力。</del></p>
<h3 id="核心思路：两阶段任务分解"><a href="#核心思路：两阶段任务分解" class="headerlink" title="核心思路：两阶段任务分解"></a>核心思路：两阶段任务分解</h3><p>为了降低复杂度并确保每一步都稳定可靠，我将整个自动化任务分解为两个独立的、前后关联的子项目：</p>
<ol>
<li><p><strong>项目一：源代码注释规范化</strong></p>
<ul>
<li><p><strong>目标：</strong> 遍历所有源代码文件，对所有注释不规范的代码进行更新，注释格式详见<strong>手动实现：基础工作流与问题排查 - 核心实现思路 - 2.</strong>。</p>
</li>
<li><p><strong>作用：</strong> 为后续的 <code>README</code> 生成器提供一个统一、可靠、可离线解析的数据源。</p>
</li>
</ul>
</li>
<li><p><strong>项目二：README 生成器</strong></p>
<ul>
<li><p><strong>目标：</strong> 读取所有经过规范化的源代码文件，提取其头部注释中的元数据，并生成最终的、完整的 Markdown 表格，用于在 <code>README.md</code> 中生成一个包含所有题目&#x2F;题解信息的表格。</p>
</li>
<li><p><strong>作用：</strong> 彻底替代手动编辑 <code>README</code> 的工作。</p>
</li>
</ul>
</li>
</ol>
<h3 id="项目一：源代码注释规范化脚本"><a href="#项目一：源代码注释规范化脚本" class="headerlink" title="项目一：源代码注释规范化脚本"></a>项目一：源代码注释规范化脚本</h3><h4 id="Case-1-编码格式不统一-中文乱码"><a href="#Case-1-编码格式不统一-中文乱码" class="headerlink" title="Case 1: 编码格式不统一 - 中文乱码"></a><strong>Case 1: 编码格式不统一 - 中文乱码</strong></h4><ul>
<li><p><strong>现象:</strong><br>当我在脚本尝试读取 <code>.cpp</code> 文件内容时，或在使用 CLion 打开从 GitHub 克隆的文件时，文件中的中文注释显示为乱码。</p>
</li>
<li><p><strong>问题分析:</strong><br>这是典型的字符编码不匹配问题。GitHub 和 CLion 默认使用 <code>UTF-8</code> 编码，它兼容全球所有语言。而我之前做题时使用的 Dev-C++ 在 Windows环境下，默认使用本地化的 <code>GBK</code> 编码保存文件。当一个程序尝试用 <code>UTF-8</code> 编码去读取一个 <code>GBK</code> 编码的文件时，就会产生乱码。</p>
</li>
<li><p><strong>解决方案:</strong><br>在整个开发链条中，强制统一使用 <code>UTF-8</code> 编码。</p>
<ol>
<li><strong>开发环境迁移：</strong> 彻底弃用对 <code>UTF-8</code> 支持不佳的旧 IDE，将主力开发环境迁移至现代化、默认使用 <code>UTF-8</code> 的 CLion。</li>
<li><strong>脚本读写配置：</strong> 在 Python 脚本中，使用 <code>open()</code> 函数时，明确指定 <code>encoding</code> 参数。读取时使用 <code>encoding=&#39;utf-8-sig&#39;</code> 以兼容 Windows 下带 BOM 的 UTF-8 文件，写入时使用 <code>encoding=&#39;utf-8&#39;</code>。<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 读取时指定编码</span></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(file_path, <span class="string">&#x27;r&#x27;</span>, encoding=<span class="string">&#x27;utf-8-sig&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    lines = f.readlines()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 写入时同样指定编码</span></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(file_path, <span class="string">&#x27;w&#x27;</span>, encoding=<span class="string">&#x27;utf-8&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    f.writelines(lines)</span><br></pre></td></tr></table></figure></li>
</ol>
</li>
</ul>
<h4 id="最终脚本：update-sources-py"><a href="#最终脚本：update-sources-py" class="headerlink" title="最终脚本：update_sources.py"></a><strong>最终脚本：<code>update_sources.py</code></strong></h4><p>该脚本的核心逻辑是：遍历指定目录下的所有 C++ 文件，检查其是否已包含标准注释头。如果没有，则从文件名中解析题号，通过网络请求访问题目 URL 抓取完整标题，并从 Git 历史中获取文件首次提交的日期。最后，将这些元数据整合成标准格式的注释块，并重写回文件头部。</p>
<p>在让Gemini充分了解了我的诉求后，一份自动化更新注释的 Python 脚本便诞生了。</p>
<details>
<summary>点击展开/折叠 `update_sources.py` 完整代码</summary>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> bs4 <span class="keyword">import</span> BeautifulSoup</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line">REPO_FOLDER = <span class="string">&quot;Coding-Practice&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_luogu_title</span>(<span class="params">url</span>):</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        headers = &#123;</span><br><span class="line">            <span class="string">&#x27;User-Agent&#x27;</span>: <span class="string">&#x27;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/91.0.4472.124 Safari/537.36&#x27;</span></span><br><span class="line">        &#125;</span><br><span class="line">        response = requests.get(url, headers=headers, timeout=<span class="number">10</span>)</span><br><span class="line">        response.raise_for_status()</span><br><span class="line"></span><br><span class="line">        soup = BeautifulSoup(response.text, <span class="string">&#x27;lxml&#x27;</span>)</span><br><span class="line"></span><br><span class="line">        title_tag = soup.find(<span class="string">&#x27;h1&#x27;</span>)</span><br><span class="line">        <span class="keyword">if</span> title_tag:</span><br><span class="line">            <span class="keyword">return</span> title_tag.get_text(strip=<span class="literal">True</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line">    <span class="keyword">except</span> requests.exceptions.RequestException <span class="keyword">as</span> e:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;    - 网络错误: 无法访问 <span class="subst">&#123;url&#125;</span> - <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">process_file</span>(<span class="params">file_path</span>):</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">with</span> <span class="built_in">open</span>(file_path, <span class="string">&#x27;r&#x27;</span>, encoding=<span class="string">&#x27;utf-8-sig&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">            lines = f.readlines()</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> lines:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;  - 跳过 (文件为空): <span class="subst">&#123;os.path.basename(file_path)&#125;</span>&quot;</span>)</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">        first_line_content = lines[<span class="number">0</span>].strip()</span><br><span class="line">        <span class="keyword">if</span> first_line_content == <span class="string">&quot;// Problem:  Luogu&quot;</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;  - 处理中: <span class="subst">&#123;os.path.basename(file_path)&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">            link_url = <span class="string">&quot;&quot;</span></span><br><span class="line">            <span class="keyword">for</span> line <span class="keyword">in</span> lines:</span><br><span class="line">                <span class="keyword">if</span> <span class="string">&quot;// Link:&quot;</span> <span class="keyword">in</span> line:</span><br><span class="line">                    <span class="keyword">match</span> = re.search(<span class="string">r&#x27;https?://[^\s]+&#x27;</span>, line)</span><br><span class="line">                    <span class="keyword">if</span> <span class="keyword">match</span>:</span><br><span class="line">                        link_url = <span class="keyword">match</span>.group(<span class="number">0</span>)</span><br><span class="line">                    <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> link_url:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&quot;    - 错误: 在文件中未找到有效的 Link URL。&quot;</span>)</span><br><span class="line">                <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">            title = get_luogu_title(link_url)</span><br><span class="line">            time.sleep(<span class="number">0.5</span>)</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> title:</span><br><span class="line">                lines[<span class="number">0</span>] = <span class="string">f&quot;// Problem:  Luogu <span class="subst">&#123;title&#125;</span>\n&quot;</span></span><br><span class="line">                <span class="keyword">with</span> <span class="built_in">open</span>(file_path, <span class="string">&#x27;w&#x27;</span>, encoding=<span class="string">&#x27;utf-8&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">                    f.writelines(lines)</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&quot;    - 更新成功！标题已设置为: <span class="subst">&#123;title&#125;</span>&quot;</span>)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&quot;    - 更新失败: 未能从 <span class="subst">&#123;link_url&#125;</span> 获取标题。&quot;</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;  - 跳过 (已处理): <span class="subst">&#123;os.path.basename(file_path)&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;  - 处理文件时发生未知错误: <span class="subst">&#123;os.path.basename(file_path)&#125;</span> - <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> os.path.isdir(REPO_FOLDER):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;错误: 文件夹 &#x27;<span class="subst">&#123;REPO_FOLDER&#125;</span>&#x27; 不存在。请确保脚本和该文件夹在同一目录下。&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;--- 开始扫描文件夹: <span class="subst">&#123;REPO_FOLDER&#125;</span> ---&quot;</span>)</span><br><span class="line"></span><br><span class="line">    all_files = <span class="built_in">sorted</span>([f <span class="keyword">for</span> f <span class="keyword">in</span> os.listdir(REPO_FOLDER) <span class="keyword">if</span> f.startswith(<span class="string">&quot;Luogu&quot;</span>) <span class="keyword">and</span> f.endswith(<span class="string">&quot;.cpp&quot;</span>)])</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> filename <span class="keyword">in</span> all_files:</span><br><span class="line">        full_path = os.path.join(REPO_FOLDER, filename)</span><br><span class="line">        process_file(full_path)</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;\n--- 扫描完成 ---&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure>

</details>

<h3 id="项目二：README-生成器脚本"><a href="#项目二：README-生成器脚本" class="headerlink" title="项目二：README 生成器脚本"></a>项目二：README 生成器脚本</h3><p>在所有源文件都拥有了标准化的元数据之后，生成 <code>README</code> 的任务就变得纯粹而直接。</p>
<h4 id="Case-1-爬虫失效"><a href="#Case-1-爬虫失效" class="headerlink" title="Case 1: 爬虫失效"></a><strong>Case 1: 爬虫失效</strong></h4><ul>
<li><p><strong>现象:</strong><br>在 <code>update_sources.py</code> 的开发过程中，用于抓取洛谷题目难度的爬虫函数，在多次尝试后依然反复失效，返回 <code>N/A</code> 或空的页面内容，即便 URL 在浏览器中可以正常访问。</p>
</li>
<li><p><strong>问题分析:</strong><br>我编写了一个独立的脚本，将 <code>requests</code> 库获取到的原始 HTML 内容保存下来后，发现我收到的并非洛谷的题目页面，而是 Cloudflare 的人机验证页面。大概是我的操作被 Cloudflare 的反爬虫机制识别并拦截了。</p>
</li>
<li><p><strong>解决方案：</strong></p>
<ol>
<li><strong>方案迭代：</strong> 我先后尝试了多种爬虫策略，包括更换 User-Agent、寻找特定的 HTML 标签（洛谷难度标签为<code>&lt;span&gt;</code>）、甚至用正则表达式直接匹配页面数据脚本，但都因为反爬虫机制的存在而宣告失败。</li>
<li><strong>最终方案：</strong> 我突然意识到，这些题目与其对应的难度，我可以<strong>直接从洛谷个人主页里保存到本地</strong>，将其变成静态数据。</li>
</ol>
<img src="/2025/09/22/%E4%BB%8E4%E5%B0%8F%E6%97%B6%E5%88%B02%E5%88%86%E9%92%9F%EF%BC%9A%E6%88%91%E7%9A%84GitHub-Profile%E8%87%AA%E5%8A%A8%E5%8C%96%E6%9E%84%E5%BB%BA%E4%B9%8B%E8%B7%AF/4.jpg" class="" title="洛谷主页">

<p>因此，我做出了一个关键的架构决策：<strong>放弃动态爬取，转向静态的本地数据源。</strong></p>
<p>我将所有题目的难度信息，手动整理成一个 Python 字典，直接内置在脚本中。</p>
<pre><code><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 本地难度数据库示例</span></span><br><span class="line">DIFFICULTY_DATA = &#123;</span><br><span class="line">    <span class="string">&quot;P1001&quot;</span>: <span class="string">&quot;入门&quot;</span>,</span><br><span class="line">    <span class="string">&quot;P1002&quot;</span>: <span class="string">&quot;普及−&quot;</span>,</span><br><span class="line">    <span class="comment"># ... and so on</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</code></pre>
<p>这个决策，让脚本彻底摆脱了 Cloudflare 的困扰，<strong>100% 可靠且运行速度速度极佳</strong>，也易于长期维护。</p>
</li>
</ul>
<h4 id="Case-2-逻辑疏漏"><a href="#Case-2-逻辑疏漏" class="headerlink" title="Case 2: 逻辑疏漏"></a><strong>Case 2: 逻辑疏漏</strong></h4><ul>
<li><p><strong>现象:</strong><br>脚本初版成功生成了所有新题目的表格行，但在后续迭代中，我发现它会丢失 <code>README.md</code> 中已有的、非洛谷平台的记录（如 Codeforces）。</p>
</li>
<li><p><strong>问题分析:</strong><br>我的脚本只考虑了“生成新的”，而没有考虑“保留旧的”和“合并排序”。</p>
</li>
<li><p><strong>解决方案:</strong><br>重构脚本的核心逻辑，使其具备多平台兼容性：</p>
<ol>
<li><strong>全面读取：</strong> 读取旧 <code>README</code> 时，不再只筛选洛谷题目，而是将所有表格行都加载到内存中。</li>
<li><strong>增量处理：</strong> 只为那些<strong>文件名</strong>不存在于旧记录中的新文件，生成新的表格行。</li>
<li><strong>合并排序：</strong> 将新生成的行与所有旧的行合并成一个总列表，最后对这个总列表，进行统一的日期降序排序。</li>
</ol>
</li>
</ul>
<h4 id="最终脚本：generate-readme-py"><a href="#最终脚本：generate-readme-py" class="headerlink" title="最终脚本：generate_readme.py"></a><strong>最终脚本：<code>generate_readme.py</code></strong></h4><p>这是经历了多次重构和 BUG 修复后的最终版本。它整合了本地难度数据库、多平台兼容、增量更新和全量排序等所有功能。</p>
<p>脚本运行后，会生成一个 <code>update.txt</code> 文件，包含了所有新旧题目的、完美排序的最终表格，我只需要将其整体复制并替换 <code>README.md</code> 中的旧表格即可。</p>
<details>
<summary>点击展开/折叠 `update_sources.py` 完整代码</summary>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">from</span> datetime <span class="keyword">import</span> datetime</span><br><span class="line"><span class="keyword">from</span> urllib.parse <span class="keyword">import</span> unquote</span><br><span class="line"></span><br><span class="line"><span class="comment"># --- Configuration ---</span></span><br><span class="line">GITHUB_USERNAME = <span class="string">&quot;nine19een&quot;</span></span><br><span class="line">REPO_NAME = <span class="string">&quot;Coding-Practice&quot;</span></span><br><span class="line">SOURCE_CODE_PATH = <span class="string">&quot;Coding-Practice&quot;</span></span><br><span class="line">README_FILE_PATH = <span class="string">&quot;README.md&quot;</span></span><br><span class="line">OUTPUT_FILENAME = <span class="string">&quot;update.txt&quot;</span></span><br><span class="line"><span class="comment"># ---------------------</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ==============================================================================</span></span><br><span class="line"><span class="comment"># Local Difficulty Database</span></span><br><span class="line"><span class="comment"># ==============================================================================</span></span><br><span class="line">DIFFICULTY_DATA = &#123;</span><br><span class="line">    <span class="string">&quot;P1001&quot;</span>: <span class="string">&quot;入门&quot;</span>, <span class="string">&quot;P1046&quot;</span>: <span class="string">&quot;入门&quot;</span>, <span class="string">&quot;P1047&quot;</span>: <span class="string">&quot;入门&quot;</span>, <span class="string">&quot;P1085&quot;</span>: <span class="string">&quot;入门&quot;</span>,</span><br><span class="line">    <span class="comment"># 略</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment"># ==============================================================================</span></span><br><span class="line"></span><br><span class="line">BADGE_TEMPLATES = &#123;</span><br><span class="line">    <span class="string">&quot;入门&quot;</span>: <span class="string">&#x27;&lt;img src=&quot;https://img.shields.io/badge/入门-FE4C61?style=for-the-badge&amp;textColor=white&quot; alt=&quot;入门&quot;&gt;&#x27;</span>,</span><br><span class="line">    <span class="string">&quot;普及−&quot;</span>: <span class="string">&#x27;&lt;img src=&quot;https://img.shields.io/badge/普及−-F39C11?style=for-the-badge&amp;textColor=white&quot; alt=&quot;普及−&quot;&gt;&#x27;</span>,</span><br><span class="line">    <span class="comment"># 略</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">load_existing_entries</span>(<span class="params">readme_path</span>):</span><br><span class="line">    existing_entries = []</span><br><span class="line">    in_table_section = <span class="literal">False</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(readme_path):</span><br><span class="line">        <span class="keyword">return</span> existing_entries</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">with</span> <span class="built_in">open</span>(readme_path, <span class="string">&#x27;r&#x27;</span>, encoding=<span class="string">&#x27;utf-8&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">            <span class="keyword">for</span> line <span class="keyword">in</span> f:</span><br><span class="line">                <span class="keyword">if</span> line.strip().startswith(<span class="string">&#x27;| :---&#x27;</span>):</span><br><span class="line">                    in_table_section = <span class="literal">True</span></span><br><span class="line">                    <span class="keyword">continue</span></span><br><span class="line">                <span class="keyword">if</span> in_table_section <span class="keyword">and</span> (<span class="keyword">not</span> line.strip().startswith(<span class="string">&#x27;|&#x27;</span>) <span class="keyword">or</span> <span class="keyword">not</span> line.strip()):</span><br><span class="line">                    in_table_section = <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> in_table_section:</span><br><span class="line">                    date_match = re.search(<span class="string">r&#x27;\|\s*(\d&#123;4&#125;-\d&#123;2&#125;-\d&#123;2&#125;)&#x27;</span>, line)</span><br><span class="line">                    date_str = date_match.group(<span class="number">1</span>) <span class="keyword">if</span> date_match <span class="keyword">else</span> <span class="string">&quot;1970-01-01&quot;</span></span><br><span class="line">                    existing_entries.append(&#123;</span><br><span class="line">                        <span class="string">&quot;date_obj&quot;</span>: datetime.strptime(date_str, <span class="string">&#x27;%Y-%m-%d&#x27;</span>),</span><br><span class="line">                        <span class="string">&quot;row&quot;</span>: line.strip()</span><br><span class="line">                    &#125;)</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;Warning: Failed to read README file: <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> existing_entries</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">parse_source_file_metadata</span>(<span class="params">file_path</span>):</span><br><span class="line">    metadata = &#123;<span class="string">&#x27;platform&#x27;</span>: <span class="string">&#x27;unknown&#x27;</span>&#125;</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">with</span> <span class="built_in">open</span>(file_path, <span class="string">&#x27;r&#x27;</span>, encoding=<span class="string">&#x27;utf-8-sig&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">            content = f.read()</span><br><span class="line"></span><br><span class="line">        date_match = re.search(<span class="string">r&#x27;//\s*Date:\s*(\d&#123;4&#125;-\d&#123;2&#125;-\d&#123;2&#125;)&#x27;</span>, content)</span><br><span class="line">        <span class="keyword">if</span> date_match: metadata[<span class="string">&#x27;date&#x27;</span>] = date_match.group(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">        link_match = re.search(<span class="string">r&#x27;//\s*Link:\s*(https?://[^\s]+)&#x27;</span>, content)</span><br><span class="line">        <span class="keyword">if</span> link_match: metadata[<span class="string">&#x27;link&#x27;</span>] = link_match.group(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">        problem_match = re.search(<span class="string">r&#x27;//\s*Problem:\s*(.*)&#x27;</span>, content)</span><br><span class="line">        <span class="keyword">if</span> problem_match:</span><br><span class="line">            line_content = problem_match.group(<span class="number">1</span>).strip()</span><br><span class="line">            <span class="keyword">if</span> line_content.lower().startswith(<span class="string">&quot;luogu&quot;</span>):</span><br><span class="line">                metadata[<span class="string">&#x27;platform&#x27;</span>] = <span class="string">&#x27;luogu&#x27;</span></span><br><span class="line">                metadata[<span class="string">&#x27;details&#x27;</span>] = line_content[<span class="number">5</span>:].strip()</span><br><span class="line">            <span class="keyword">elif</span> line_content.lower().startswith(<span class="string">&quot;codeforces&quot;</span>):</span><br><span class="line">                metadata[<span class="string">&#x27;platform&#x27;</span>] = <span class="string">&#x27;codeforces&#x27;</span></span><br><span class="line">                metadata[<span class="string">&#x27;details&#x27;</span>] = line_content[<span class="number">10</span>:].strip()</span><br><span class="line">            <span class="keyword">elif</span> line_content.lower().startswith(<span class="string">&quot;opj&quot;</span>):</span><br><span class="line">                metadata[<span class="string">&#x27;platform&#x27;</span>] = <span class="string">&#x27;opj&#x27;</span></span><br><span class="line">                metadata[<span class="string">&#x27;details&#x27;</span>] = line_content[<span class="number">3</span>:].strip()</span><br><span class="line">        <span class="keyword">return</span> metadata</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;    - Error: Failed to parse file <span class="subst">&#123;os.path.basename(file_path)&#125;</span>: <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">build_markdown_row</span>(<span class="params">metadata, filename</span>):</span><br><span class="line">    date = metadata.get(<span class="string">&#x27;date&#x27;</span>, <span class="string">&#x27;N/A&#x27;</span>)</span><br><span class="line">    platform = metadata.get(<span class="string">&#x27;platform&#x27;</span>)</span><br><span class="line">    details = metadata.get(<span class="string">&#x27;details&#x27;</span>, <span class="string">&#x27;&#x27;</span>)</span><br><span class="line">    link = metadata.get(<span class="string">&#x27;link&#x27;</span>, <span class="string">&#x27;#&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    problem_md, difficulty_badge = <span class="string">f&quot;[<span class="subst">&#123;platform&#125;</span>-<span class="subst">&#123;details&#125;</span>](<span class="subst">&#123;link&#125;</span>)&quot;</span>, <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> platform == <span class="string">&#x27;luogu&#x27;</span>:</span><br><span class="line">        pid_match = re.search(<span class="string">r&#x27;([PB]\d+)&#x27;</span>, details)</span><br><span class="line">        <span class="keyword">if</span> pid_match:</span><br><span class="line">            problem_id = pid_match.group(<span class="number">1</span>)</span><br><span class="line">            title = re.sub(<span class="string">r&#x27;「.*?」|\[.*?\]|【.*?】&#x27;</span>, <span class="string">&#x27;&#x27;</span>, details).replace(problem_id, <span class="string">&#x27;&#x27;</span>).strip()</span><br><span class="line">            problem_md = <span class="string">f&quot;[<span class="subst">&#123;<span class="string">&#x27;洛谷&#x27;</span>&#125;</span>-<span class="subst">&#123;problem_id&#125;</span>-<span class="subst">&#123;title&#125;</span>](<span class="subst">&#123;link&#125;</span>)&quot;</span></span><br><span class="line">            difficulty_text = DIFFICULTY_DATA.get(problem_id, <span class="string">&quot;未定义&quot;</span>)</span><br><span class="line">            difficulty_badge = BADGE_TEMPLATES.get(difficulty_text, BADGE_TEMPLATES[<span class="string">&quot;未定义&quot;</span>])</span><br><span class="line">    <span class="keyword">elif</span> platform == <span class="string">&#x27;codeforces&#x27;</span>:</span><br><span class="line">        id_letter_match = re.search(<span class="string">r&#x27;-([A-F]\d?)-&#x27;</span>, filename) <span class="keyword">or</span> re.search(<span class="string">r&#x27;\s+([A-F]\d?)\.&#x27;</span>, details)</span><br><span class="line">        <span class="keyword">if</span> id_letter_match:</span><br><span class="line">            id_letter = id_letter_match.group(<span class="number">1</span>)[<span class="number">0</span>]</span><br><span class="line">            badge_key = <span class="string">f&quot;Div.4 <span class="subst">&#123;id_letter&#125;</span>&quot;</span></span><br><span class="line">            difficulty_badge = BADGE_TEMPLATES.get(badge_key, <span class="string">&quot;**CF**&quot;</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            difficulty_badge = <span class="string">&quot;**CF**&quot;</span></span><br><span class="line">        problem_md = <span class="string">f&quot;[Codeforces-<span class="subst">&#123;details&#125;</span>](<span class="subst">&#123;link&#125;</span>)&quot;</span></span><br><span class="line">    <span class="keyword">elif</span> platform == <span class="string">&#x27;opj&#x27;</span>:</span><br><span class="line">        pid_match = re.search(<span class="string">r&#x27;(\d+)&#x27;</span>, details)</span><br><span class="line">        problem_id = pid_match.group(<span class="number">1</span>) <span class="keyword">if</span> pid_match <span class="keyword">else</span> <span class="string">&#x27;&#x27;</span></span><br><span class="line">        title = details.replace(problem_id, <span class="string">&#x27;&#x27;</span>).strip()</span><br><span class="line">        problem_md = <span class="string">f&quot;[opj-<span class="subst">&#123;problem_id&#125;</span>-<span class="subst">&#123;title&#125;</span>](<span class="subst">&#123;link&#125;</span>)&quot;</span></span><br><span class="line">        difficulty_badge = BADGE_TEMPLATES.get(<span class="string">&quot;基础&quot;</span>, <span class="string">&quot;&quot;</span>)</span><br><span class="line"></span><br><span class="line">    safe_filename = filename.replace(<span class="string">&#x27;+&#x27;</span>, <span class="string">&#x27;%2B&#x27;</span>)</span><br><span class="line">    solution_md = <span class="string">f&quot;[View Code (C++)](https://github.com/<span class="subst">&#123;GITHUB_USERNAME&#125;</span>/<span class="subst">&#123;REPO_NAME&#125;</span>/blob/main/<span class="subst">&#123;safe_filename&#125;</span>)&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        <span class="string">&quot;date_obj&quot;</span>: datetime.strptime(date, <span class="string">&#x27;%Y-%m-%d&#x27;</span>),</span><br><span class="line">        <span class="string">&quot;row&quot;</span>: <span class="string">f&quot;| <span class="subst">&#123;date&#125;</span> | <span class="subst">&#123;problem_md&#125;</span> | <span class="subst">&#123;difficulty_badge&#125;</span> | <span class="subst">&#123;solution_md&#125;</span> |&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;--- Initializing README Generation ---&quot;</span>)</span><br><span class="line"></span><br><span class="line">    existing_entries = load_existing_entries(README_FILE_PATH)</span><br><span class="line">    existing_filenames = <span class="built_in">set</span>(unquote(re.search(<span class="string">r&#x27;/main/(.*)\)&#x27;</span>, entry[<span class="string">&#x27;row&#x27;</span>]).group(<span class="number">1</span>)) <span class="keyword">for</span> entry <span class="keyword">in</span> existing_entries <span class="keyword">if</span> re.search(<span class="string">r&#x27;/main/(.*)\)&#x27;</span>, entry[<span class="string">&#x27;row&#x27;</span>]))</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;Found <span class="subst">&#123;<span class="built_in">len</span>(existing_entries)&#125;</span> existing entries in README.&quot;</span>)</span><br><span class="line"></span><br><span class="line">    all_entries = existing_entries</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> os.path.isdir(SOURCE_CODE_PATH):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;Error: Source code directory &#x27;<span class="subst">&#123;SOURCE_CODE_PATH&#125;</span>&#x27; not found.&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;\n--- Scanning for new source files in <span class="subst">&#123;SOURCE_CODE_PATH&#125;</span> ---&quot;</span>)</span><br><span class="line"></span><br><span class="line">    all_cpp_files = <span class="built_in">sorted</span>([f <span class="keyword">for</span> f <span class="keyword">in</span> os.listdir(SOURCE_CODE_PATH) <span class="keyword">if</span> f.endswith(<span class="string">&quot;.cpp&quot;</span>)])</span><br><span class="line">    new_files_processed = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> filename <span class="keyword">in</span> all_cpp_files:</span><br><span class="line">        <span class="keyword">if</span> filename <span class="keyword">in</span> existing_filenames:</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line"></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;  - Processing new file: <span class="subst">&#123;filename&#125;</span>&quot;</span>)</span><br><span class="line">        new_files_processed += <span class="number">1</span></span><br><span class="line"></span><br><span class="line">        file_path = os.path.join(SOURCE_CODE_PATH, filename)</span><br><span class="line">        metadata = parse_source_file_metadata(file_path)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> metadata <span class="keyword">or</span> <span class="string">&#x27;date&#x27;</span> <span class="keyword">not</span> <span class="keyword">in</span> metadata:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;    - Warning: Could not parse required metadata from <span class="subst">&#123;filename&#125;</span>. Skipping.&quot;</span>)</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line"></span><br><span class="line">        new_entry = build_markdown_row(metadata, filename)</span><br><span class="line">        all_entries.append(new_entry)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> new_files_processed == <span class="number">0</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;\n--- No new files to add. README is up to date. ---&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;\n--- Processed <span class="subst">&#123;new_files_processed&#125;</span> new files. Generating final table. ---&quot;</span>)</span><br><span class="line"></span><br><span class="line">    all_entries.sort(key=<span class="keyword">lambda</span> x: x[<span class="string">&#x27;date_obj&#x27;</span>], reverse=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">with</span> <span class="built_in">open</span>(OUTPUT_FILENAME, <span class="string">&#x27;w&#x27;</span>, encoding=<span class="string">&#x27;utf-8&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">            f.write(<span class="string">&quot;| Date       | Problem                                                    | Difficulty                                                                                                   | Solution                                                                                  |\n&quot;</span>)</span><br><span class="line">            f.write(<span class="string">&quot;| :--------- | :--------------------------------------------------------- | :----------------------------------------------------------------------------------------------------------- | :---------------------------------------------------------------------------------------- |\n&quot;</span>)</span><br><span class="line">            <span class="keyword">for</span> entry <span class="keyword">in</span> all_entries:</span><br><span class="line">                f.write(entry[<span class="string">&#x27;row&#x27;</span>] + <span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;\n&quot;</span> + <span class="string">&quot;=&quot;</span>*<span class="number">50</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;Success! The complete and sorted table has been saved to:&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;os.path.abspath(OUTPUT_FILENAME)&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Please copy the entire content of this file and replace the old table in your README.&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;=&quot;</span>*<span class="number">50</span>)</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;\nError! Failed to write output file: <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure>

</details>

<hr>
<h2 id="最终成果展示"><a href="#最终成果展示" class="headerlink" title="最终成果展示"></a>最终成果展示</h2><p>经过上述一系列的手动迁移、自动化脚本构建与 <code>README.md</code> 内容生成，我的 GitHub Profile 最终呈现为一个动态更新、信息丰富的个人技术档案。</p>
<p>它现在不仅包含了<strong>真实反映我学习时间的贡献图</strong>，还有一个<strong>内容详尽、格式统一、且能够通过自动化脚本持续更新的刷题记录面板</strong>。</p>
<img src="/2025/09/22/%E4%BB%8E4%E5%B0%8F%E6%97%B6%E5%88%B02%E5%88%86%E9%92%9F%EF%BC%9A%E6%88%91%E7%9A%84GitHub-Profile%E8%87%AA%E5%8A%A8%E5%8C%96%E6%9E%84%E5%BB%BA%E4%B9%8B%E8%B7%AF/5.png" class="" title="github主页">

<p>这个 Profile 将忠实地记录下我大学四年走的每一步。</p>
<p><strong>欢迎访问我的➡️ <strong><a target="_blank" rel="noopener" href="https://github.com/nine19een">GitHub 主页</a></strong> ⬅️以查看最新进展与项目源码，也欢迎各位大佬前来指点~</strong></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>





</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 
    <span itemprop="copyrightYear">2025</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">nine19een</span>
  </div>

    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>

</body>
</html>
